<!DOCTYPE html>
<html 
	lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
<link rel="stylesheet" href="/css/layout.css">

		
		<title> iLQRå­¦ä¹  -  KKç©ºé—´</title>
		<!-- <link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" /> -->
		<!-- <script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script> -->
		
<link rel="stylesheet" href="/lib/mdui/mdui.min.css">

		
<script src="/lib/mdui/mdui.min.js"></script>

		<!-- lazyload -->
		
<script src="/lib/lazysizes.js"></script>

		<!-- smooth-scrolling -->
		
<script src="/lib/smooth-scrolling.js"></script>

		<!-- highlight -->
		
<link rel="stylesheet" href="/lib/highlight/atom-one-dark.min.css">

		
<script src="/lib/highlight/highlight.min.js"></script>

		<!-- é¢„ç½® kiraicon -->
		
<link rel="stylesheet" href="/lib/iconfont/iconfont.css">

		
		<link
			rel="shortcut icon"
			href="/image/fa.jpeg"
			type="image/jpeg"
		/>
		
<link rel="stylesheet" href="/deps/css/APlayer.min.css">

		
		
<script src="/deps/js/APlayer.min.js"></script>
<script src="/deps/js/Meting.min.js"></script>

	<!-- hexo injector head_end start -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$']],
          displayMath: [['$$', '$$']],
          processEscapes: true
        }
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>

	<body>
		<div
			class="kira-background"
			style="background-image: url('/image/frieren.png')"
		></div>
		<div class="kira-header">
    <a
        class="kira-drawer-button mdui-ripple"
        title="å¯¼èˆªæ "
        onclick="document.querySelector('.kira-sidebar-modal').classList.add('show');document.querySelector('.kira-sidebar#sidebar').classList.add('show');"
    >
        <i class="kirafont icon-menu"></i>
    </a>
    <a href="/" title="KKç©ºé—´">
        <img
			src="/image/chongye.png"
			alt="æˆ˜æ–—åŒ…å­"
		/>
    </a>
</div>
		<div class="kira-body">
			<div class="kira-sidebar" id="sidebar">
	<div class="kira-avatar mdui-ripple">
		<a href="/image/chongye.png" title="æˆ˜æ–—åŒ…å­">
			<img
				src="/image/chongye.png"
				alt="æˆ˜æ–—åŒ…å­"
			/>
		</a>
	</div>
	<div class="kira-count">
		<div><span>æ–‡ç« </span>124</div>
		<div><span>æ ‡ç­¾</span>24</div>
		<div><span>åˆ†ç±»</span>0</div>
	</div>
	<div class="kira-list">
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/"
			title="å›åˆ°é¦–é¡µ"
		>
			<i
				class="kirafont
					
						icon-home
					"
			></i>
			<div class="kira-list-item-content">
				å›åˆ°é¦–é¡µ
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/archive.html"
			title="æ–‡ç« å½’æ¡£"
		>
			<i
				class="kirafont
					
						icon-container
					"
			></i>
			<div class="kira-list-item-content">
				æ–‡ç« å½’æ¡£
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/about.html"
			title="å…³äºæœ¬äºº"
		>
			<i
				class="kirafont
					
						icon-user
					"
			></i>
			<div class="kira-list-item-content">
				å…³äºæœ¬äºº
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/friends.html"
			title="æˆ‘çš„æœ‹å‹"
		>
			<i
				class="kirafont
					
						icon-team
					"
			></i>
			<div class="kira-list-item-content">
				æˆ‘çš„æœ‹å‹
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/todolist.html"
			title="æˆ‘çš„Todo"
		>
			<i
				class="kirafont
					
						icon-container-fill
					"
			></i>
			<div class="kira-list-item-content">
				æˆ‘çš„Todo
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/liferecords"
			title="ç©äº†ä»€ä¹ˆ"
		>
			<i
				class="kirafont
					
						icon-fullscreen
					"
			></i>
			<div class="kira-list-item-content">
				ç©äº†ä»€ä¹ˆ
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/game_graph.html"
			title="å°å›¾"
		>
			<i
				class="kirafont
					
						icon-fullscreen
					"
			></i>
			<div class="kira-list-item-content">
				å°å›¾
			</div>
		</a>
		
	</div>
	<aside id="kira-sidebar">
		
			<div class="kira-widget-wrap">
	<div class="kira-widget kira-social">
		
			<a
				class="mdui-ripple"
				href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1040035659&website=www.oicqzone.com"
				target="_blank"
				mdui-tooltip="{content: 'QQ'}"
				style="color: rgb(49, 174, 255); background-color: rgba(49, 174, 255, .1);"
			>
				<i
					class="kirafont
					
						icon-QQ
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://space.bilibili.com/6456506"
				target="_blank"
				mdui-tooltip="{content: 'å“”å“©å“”å“©'}"
				style="color: rgb(231, 106, 141); background-color: rgba(231, 106, 141, .15);"
			>
				<i
					class="kirafont
					
						icon-bilibili
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://github.com/PaiPai121/"
				target="_blank"
				mdui-tooltip="{content: 'GitHub'}"
				style="color: rgb(25, 23, 23); background-color: rgba(25, 23, 23, .15);"
			>
				<i
					class="kirafont
					
						icon-github
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://gitee.com/<ä½ çš„gitee id>"
				target="_blank"
				mdui-tooltip="{content: 'Gitee'}"
				style="color: rgb(165, 15, 15); background-color: rgba(165, 15, 15, .15);"
			>
				<i
					class="kirafont
					
						icon-gitee
					"
				></i>
			</a>
		
	</div>
</div>

		
			
		
			
	<div class="kira-widget-wrap">
		<div id="randomtagcloud" class="kira-widget tagcloud kira-rainbow">
			<a href="/tags/AI/" style="font-size: 11.11px;">AI</a> <a href="/tags/GameExtend/" style="font-size: 14.44px;">GameExtend</a> <a href="/tags/MMD/" style="font-size: 11.11px;">MMD</a> <a href="/tags/flash/" style="font-size: 11.11px;">flash</a> <a href="/tags/gaea%E6%A1%86%E6%9E%B6/" style="font-size: 13.33px;">gaeaæ¡†æ¶</a> <a href="/tags/travel/" style="font-size: 10px;">travel</a> <a href="/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/" style="font-size: 18.89px;">å…¬ä¼—å·</a> <a href="/tags/%E5%87%B8%E4%BC%98%E5%8C%96/" style="font-size: 11.11px;">å‡¸ä¼˜åŒ–</a> <a href="/tags/%E5%A6%99%E7%93%A6%E5%BA%95/" style="font-size: 10px;">å¦™ç“¦åº•</a> <a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 20px;">å­¦ä¹ </a> <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 10px;">å·¥ä½œ</a> <a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 12.22px;">å¼€å‘</a> <a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" style="font-size: 12.22px;">å¼ºåŒ–å­¦ä¹ </a> <a href="/tags/%E6%80%80%E6%97%A7/" style="font-size: 11.11px;">æ€€æ—§</a> <a href="/tags/%E6%88%91%E7%9A%84%E8%AE%BA%E6%96%87/" style="font-size: 10px;">æˆ‘çš„è®ºæ–‡</a> <a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 17.78px;">æ—¥å¸¸</a> <a href="/tags/%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A1%A3/" style="font-size: 18.89px;">æœ¬åœ°å­˜æ¡£</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E6%9D%82%E8%B0%88/" style="font-size: 16.67px;">æ¸¸æˆæ‚è°ˆ</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E8%A1%8D%E7%94%9F/" style="font-size: 10px;">æ¸¸æˆè¡ç”Ÿ</a> <a href="/tags/%E7%9C%8B%E7%95%AA/" style="font-size: 11.11px;">çœ‹ç•ª</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 11.11px;">ç¼–ç¨‹åŸºæœ¬çŸ¥è¯†</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" style="font-size: 10px;">è‡ªåŠ¨é©¾é©¶</a> <a href="/tags/%E8%8D%89%E5%B1%A5%E8%99%AB%E7%9A%84%E7%AB%AF%E5%88%B0%E7%AB%AF/" style="font-size: 11.11px;">è‰å±¥è™«çš„ç«¯åˆ°ç«¯</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15.56px;">é¢è¯•</a>
		</div>
		
	</div>


		
			
	<div class="kira-widget-wrap">
		<h3 class="kira-widget-title">
			æ–‡ç« å½’æ¡£
		</h3>
		<div class="kira-widget">
			<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2026/">2026</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/">2025</a><span class="archive-list-count">62</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/">2024</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">13</span></li></ul>
		</div>
	</div>


		
	</aside>
	<div class="kira-copyright">
		&copy; 2026
		<a href="/">æˆ˜æ–—åŒ…å­</a>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> &
		<a href="https://github.com/ch1ny/kira-hexo/" target="_blank">Kira-Hexo</a>
		<br />
		
		
	</div>
</div>
<div
	class="kira-sidebar-modal"
	id="sidebar-modal"
	onclick="(function(self) {
		self.classList.remove('show');
		document.querySelector('.kira-sidebar.show#sidebar').classList.remove('show');
	})(this)"
></div>
			<div class="kira-content">
				<div id="kira-top-header"></div>
				<div class="kira-main-content">
					
<link rel="stylesheet" href="/css/kira-image.css">


<script src="/js/kira-image.js"></script>

<div class="kira-image">
    <div class="kira-image-modal">
        <div class="kira-image-header">
            <div class="kira-image-counter"></div>
            <div class="kira-image-title"></div>
            <div class="kira-image-operation">
                <div class="kira-image-operation-button" id="kira-image-operation-button-zoom">
                    <i class="kirafont icon-zoom-in"></i>
                </div>
                <div class="kira-image-operation-button" id="kira-image-operation-button-close">
                    <i class="kirafont icon-close"></i>
                </div>
            </div>
        </div>
        <div class="kira-image-container">
            <div class="kira-image-prev-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-left"></i>
                </div>
            </div>
            <div class="kira-image-list">
                <div class="kira-image-prev">
                    <img />
                </div>
                <div class="kira-image-now">
                    <img />
                </div>
                <div class="kira-image-next">
                    <img />
                </div>
            </div>
            <div class="kira-image-next-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-right"></i>
                </div>
            </div>
        </div>
    </div>
</div>

	
<link rel="stylesheet" href="/css/kira-code-copy.css">

	
<script src="/js/kira-code-copy.js"></script>


<div class="kira-post">
	<article>
		
		<div class="kira-post-cover">
			<img
				data-src="/image/xljdlnp.webp"
				data-sizes="auto"
				alt="iLQRå­¦ä¹ "
				class="lazyload kira-post-cover-image disabled-kira-image"
			/>
			<h1>iLQRå­¦ä¹ </h1>
		</div>
		
		<div class="kira-post-meta kira-rainbow" style="margin:10px 0!important;">
			<a><i class="kirafont icon-calendar-fill"></i>2025å¹´11æœˆ08æ—¥</a>
			<a><i class="kirafont icon-edit-fill"></i>10.6k å­—</a>
			<a><i class="kirafont icon-time-circle-fill"></i>å¤§æ¦‚ 53 åˆ†é’Ÿ</a>
		</div>
		<!-- toc --><html><head></head><body><ul>
<li><a href="#lqr%E5%9F%BA%E7%A1%80">LQRåŸºç¡€</a>
<ul>
<li><a href="#kn-1-%E6%97%B6%E5%88%BB%E7%9A%84%E6%9C%80%E4%BC%98%E6%8E%A7%E5%88%B6%E5%BE%8B-u_n-1">$k=N-1$ æ—¶åˆ»çš„æœ€ä¼˜æ§åˆ¶å¾‹ $u^*_{N-1}$</a></li>
<li><a href="#riccati">Riccati</a>
<ul>
<li><a href="#%E5%AE%8C%E6%95%B4%E5%BD%A2%E5%BC%8Friccati%E6%96%B9%E7%A8%8B">å®Œæ•´å½¢å¼Riccatiæ–¹ç¨‹</a></li>
<li><a href="#%E6%A0%87%E5%87%86%E7%9A%84-%E7%A6%BB%E6%95%A3%E6%97%B6%E9%97%B4-riccati-%E7%9F%A9%E9%98%B5%E6%96%B9%E7%A8%8B-dare">æ ‡å‡†çš„ ç¦»æ•£æ—¶é—´ Riccati çŸ©é˜µæ–¹ç¨‹ (DARE)ï¼š</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ilqr">iLQR</a>
<ul>
<li><a href="#%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E7%94%A8ilqr%E5%8E%BB%E4%BC%98%E5%8C%96%E8%BD%A8%E8%BF%B9">å¦‚æœæˆ‘ä»¬ç”¨iLQRå»ä¼˜åŒ–è½¨è¿¹</a></li>
<li><a href="#%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0%E7%9A%84%E4%BA%8C%E6%AC%A1%E5%8C%96%E5%B1%80%E9%83%A8%E6%88%90%E6%9C%AC">ç›®æ ‡å‡½æ•°çš„äºŒæ¬¡åŒ–ï¼ˆå±€éƒ¨æˆæœ¬ï¼‰</a>
<ul>
<li><a href="#%E8%BF%90%E8%A1%8C%E6%88%90%E6%9C%AC">è¿è¡Œæˆæœ¬</a></li>
<li><a href="#%E7%BB%88%E7%AB%AF%E6%88%90%E6%9C%AC">ç»ˆç«¯æˆæœ¬</a></li>
</ul>
</li>
<li><a href="#ilqr-%E4%B8%8E-lqr-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9%E5%B7%AE%E5%BC%82">iLQR ä¸ LQR çš„çº¿æ€§é¡¹å·®å¼‚</a>
<ul>
<li><a href="#%F0%9F%94%B9-lqr-linear-quadratic-regulator%E7%BA%AF%E4%BA%8C%E6%AC%A1%E5%9E%8B">ğŸ”¹ LQR (Linear Quadratic Regulator)ï¼šçº¯äºŒæ¬¡å‹</a>
<ul>
<li><a href="#a-%E9%9B%B6%E5%8F%82%E8%80%83%E5%92%8C%E9%9B%B6%E6%A2%AF%E5%BA%A6-zero-reference--zero-gradient">A. é›¶å‚è€ƒå’Œé›¶æ¢¯åº¦ (Zero Reference &amp; Zero Gradient)</a></li>
<li><a href="#b-%E8%B4%9D%E5%B0%94%E6%9B%BC%E6%96%B9%E7%A8%8B%E7%9A%84%E6%80%A7%E8%B4%A8%E7%BA%BF%E6%80%A7%E9%A1%B9%E6%B6%88%E5%A4%B1">B. è´å°”æ›¼æ–¹ç¨‹çš„æ€§è´¨ï¼šçº¿æ€§é¡¹æ¶ˆå¤±</a></li>
</ul>
</li>
<li><a href="#%F0%9F%94%B9-ilqr-iterative-lqr%E4%BB%BF%E5%B0%84%E4%BA%8C%E6%AC%A1%E5%9E%8B-affine-quadratic">ğŸ”¹ iLQR (Iterative LQR)ï¼šä»¿å°„äºŒæ¬¡å‹ (Affine Quadratic)</a>
<ul>
<li><a href="#a-%E8%BD%A8%E8%BF%B9%E5%81%8F%E7%A6%BB%E5%8E%9F%E7%82%B9%E5%AD%98%E5%9C%A8%E9%9D%9E%E9%9B%B6%E6%A2%AF%E5%BA%A6-non-zero-gradient">A. è½¨è¿¹åç¦»åŸç‚¹ï¼Œå­˜åœ¨éé›¶æ¢¯åº¦ (Non-Zero Gradient)</a></li>
<li><a href="#b-%E7%BA%BF%E6%80%A7%E9%A1%B9%E7%9A%84%E5%BC%95%E5%85%A5%E9%A9%B1%E5%8A%A8%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B">B. çº¿æ€§é¡¹çš„å¼•å…¥ï¼šé©±åŠ¨ä¼˜åŒ–è¿‡ç¨‹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%F0%9F%8E%AF-%E6%80%BB%E7%BB%93%E7%BA%BF%E6%80%A7%E9%A1%B9%E7%9A%84%E4%BD%9C%E7%94%A8">ğŸ¯ æ€»ç»“ï¼šçº¿æ€§é¡¹çš„ä½œç”¨</a></li>
<li><a href="#ilqr%E7%9A%84%E6%9C%80%E4%BC%98%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0">iLQRçš„æœ€ä¼˜ç›®æ ‡å‡½æ•°</a>
<ul>
<li><a href="#%E9%80%92%E6%8E%A8%E8%BF%87%E7%A8%8Bk--1------k">é€’æ¨è¿‡ç¨‹k + 1 ----&gt; kï¼š</a>
<ul>
<li><a href="#2-%E5%B7%B2%E7%9F%A5%E4%BF%A1%E6%81%AF-%E8%BE%93%E5%85%A5">2. å·²çŸ¥ä¿¡æ¯ (è¾“å…¥)</a></li>
<li><a href="#%E7%9E%AC%E6%97%B6%E6%88%90%E6%9C%AC-l-%E7%9A%84%E5%B1%95%E5%BC%80-%E7%9B%B4%E6%8E%A5%E5%B1%95%E5%BC%80">ç¬æ—¶æˆæœ¬ $l$ çš„å±•å¼€ (ç›´æ¥å±•å¼€)</a></li>
<li><a href="#%E6%9C%AA%E6%9D%A5%E6%88%90%E6%9C%AC-v_k1-%E7%9A%84%E5%B1%95%E5%BC%80-%E9%93%BE%E5%BC%8F%E6%B3%95%E5%88%99">æœªæ¥æˆæœ¬ $V_{k+1}$ çš„å±•å¼€ (é“¾å¼æ³•åˆ™)</a>
<ul>
<li><a href="#v_k1-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9%E5%B1%95%E5%BC%80">$V_{k+1}$ çš„çº¿æ€§é¡¹å±•å¼€</a></li>
<li><a href="#v_k1-%E7%9A%84%E4%BA%8C%E6%AC%A1%E9%A1%B9%E5%B1%95%E5%BC%80">$V_{k+1}$ çš„äºŒæ¬¡é¡¹å±•å¼€</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%90%88%E6%88%90-q-%E5%87%BD%E6%95%B0%E7%B3%BB%E6%95%B0">åˆæˆ Q å‡½æ•°ç³»æ•°</a>
<ul>
<li><a href="#%E6%A2%AF%E5%BA%A6-boldsymbolq-%E5%AF%B9-boldsymboldelta-x_k-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9">æ¢¯åº¦ $\boldsymbol{q}$ (å¯¹ $\boldsymbol{\delta x}_k$ çš„çº¿æ€§é¡¹)</a></li>
<li><a href="#%E6%A2%AF%E5%BA%A6-boldsymbolr-%E5%AF%B9-boldsymboldelta-u_k-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9">æ¢¯åº¦ $\boldsymbol{r}$ (å¯¹ $\boldsymbol{\delta u}_k$ çš„çº¿æ€§é¡¹)</a></li>
<li><a href="#hessian-boldsymbolq-%E5%AF%B9-boldsymboldelta-x_k-boldsymboldelta-x_k-%E7%9A%84%E4%BA%8C%E6%AC%A1%E9%A1%B9">Hessian $\boldsymbol{Q}$ (å¯¹ $\boldsymbol{\delta x}_k, \boldsymbol{\delta x}_k$ çš„äºŒæ¬¡é¡¹)</a></li>
<li><a href="#hessian-boldsymbolr-%E5%AF%B9-boldsymboldelta-u_k-boldsymboldelta-u_k-%E7%9A%84%E4%BA%8C%E6%AC%A1%E9%A1%B9">Hessian $\boldsymbol{R}$ (å¯¹ $\boldsymbol{\delta u}_k, \boldsymbol{\delta u}_k$ çš„äºŒæ¬¡é¡¹)</a></li>
<li><a href="#hessian-boldsymbolm-%E5%AF%B9-boldsymboldelta-x_k-boldsymboldelta-u_k-%E7%9A%84%E4%BA%A4%E5%8F%89%E9%A1%B9">Hessian $\boldsymbol{M}$ (å¯¹ $\boldsymbol{\delta x}_k, \boldsymbol{\delta u}_k$ çš„äº¤å‰é¡¹)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%B1%82%E8%A7%A3%E6%9C%80%E4%BC%98%E6%8E%A7%E5%88%B6%E6%89%B0%E5%8A%A8">æ±‚è§£æœ€ä¼˜æ§åˆ¶æ‰°åŠ¨</a></li>
<li><a href="#%E9%80%92%E6%8E%A8%E8%BF%87%E7%A8%8B-k-k-1">é€’æ¨è¿‡ç¨‹ k-&gt;k-1</a></li>
<li><a href="#%E5%89%8D%E5%90%91%E6%9B%B4%E6%96%B0">å‰å‘æ›´æ–°</a>
<ul>
<li><a href="#a-%E6%AD%A5%E9%95%BF%E4%B8%8E%E7%BA%BF%E6%80%A7%E6%90%9C%E7%B4%A2-line-search">A. æ­¥é•¿ä¸çº¿æ€§æœç´¢ (Line Search)</a></li>
<li><a href="#b-%E5%89%8D%E5%90%91%E6%9B%B4%E6%96%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%AD%A5%E9%AA%A4">B. å‰å‘æ›´æ–°çš„æ‰§è¡Œæ­¥éª¤</a></li>
</ul>
</li>
<li><a href="#%E8%BF%AD%E4%BB%A3%E4%B8%8E%E6%94%B6%E6%95%9B">è¿­ä»£ä¸æ”¶æ•›</a>
<ul>
<li><a href="#%E4%B8%80%E4%BA%9B%E7%96%91%E6%83%91%E4%B8%8E%E8%A7%A3%E7%AD%94">ä¸€äº›ç–‘æƒ‘ä¸è§£ç­”</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%AE%A1%E7%AE%97ck%E5%91%A2">ä»€ä¹ˆæ—¶å€™è®¡ç®—ckå‘¢ï¼Ÿ</a></li>
<li><a href="#%E7%BB%99%E5%87%BA%E4%B8%80%E6%9D%A1%E8%BD%A8%E8%BF%B9%E6%B2%A1%E6%9C%89%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%A8%A1%E5%9E%8B%E6%80%8E%E4%B9%88%E5%8A%9E">ç»™å‡ºä¸€æ¡è½¨è¿¹æ²¡æœ‰åŠ¨åŠ›å­¦æ¨¡å‹æ€ä¹ˆåŠï¼Ÿ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#lqr%E4%B8%8Eilqr">LQRä¸iLQR</a></li>
<li><a href="#ilqr-alilqr-cilqr-%E7%AE%97%E6%B3%95%E7%89%B9%E5%BE%81%E5%AF%B9%E6%AF%94">iLQR, ALiLQR, CILQR ç®—æ³•ç‰¹å¾å¯¹æ¯”</a>
<ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E5%BE%81%E5%AF%B9%E6%AF%94%E8%A1%A8">æ ¸å¿ƒç‰¹å¾å¯¹æ¯”è¡¨</a></li>
<li><a href="#1-ilqr-iterative-linear-quadratic-regulator">1. <code>iLQR</code> (Iterative Linear Quadratic Regulator)</a></li>
<li><a href="#2-alilqr-augmented-lagrangian-ilqr">2. <code>ALiLQR</code> (Augmented Lagrangian iLQR)</a></li>
<li><a href="#3-cilqr-constrained-ilqr">3. <code>CILQR</code> (Constrained iLQR)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#alilqr%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8">ALiLQRåœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨</a>
<ul>
<li><a href="#%E8%BD%A6%E8%BE%86%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%A8%A1%E5%9E%8B">è½¦è¾†åŠ¨åŠ›å­¦æ¨¡å‹</a>
<ul>
<li><a href="#1%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%98%E9%87%8F">1.å®šä¹‰çŠ¶æ€å˜é‡å’Œæ§åˆ¶å˜é‡</a></li>
<li><a href="#2%E5%AE%9E%E7%8E%B0%E8%BF%90%E5%8A%A8%E6%96%B9%E7%A8%8B%E4%B8%8E%E7%A7%AF%E5%88%86%E7%A6%BB%E6%95%A3">2.å®ç°è¿åŠ¨æ–¹ç¨‹ä¸ç§¯åˆ†ç¦»æ•£</a></li>
</ul>
</li>
<li><a href="#%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E6%B1%82%E8%A7%A3%E6%9C%80%E4%BC%98%E6%8E%A7%E5%88%B6">åå‘ä¼ æ’­ï¼Œæ±‚è§£æœ€ä¼˜æ§åˆ¶</a></li>
<li><a href="#%E5%89%8D%E5%90%91%E9%80%92%E6%8E%A8forward-pass">å‰å‘é€’æ¨Forward Pass</a></li>
<li><a href="#%E8%BD%A8%E8%BF%B9cost%E8%AE%A1%E7%AE%97">è½¨è¿¹costè®¡ç®—</a></li>
<li><a href="#alilqr%E7%9A%84%E5%A4%96%E5%B1%82%E5%BE%AA%E7%8E%AF">ALiLQRçš„å¤–å±‚å¾ªç¯</a></li>
<li><a href="#alilqr%E7%9A%84constraincost%E6%9E%84%E5%BB%BA">ALiLQRçš„ConstrainCostæ„å»º</a>
<ul>
<li><a href="#%E7%BB%84%E8%A3%85">ç»„è£…ï¼š</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1><span id="lqr%E5%9F%BA%E7%A1%80">LQRåŸºç¡€</span></h1>
<p>çŠ¶æ€è½¬ç§»ï¼š</p>
<p>$$x_{k+1} = A_k x_t + B_ku_t$$
éœ€è¦ä½¿å¦‚ä¸‹ç›®æ ‡å‡½æ•°æœ€ä¼˜</p>
<p>$$J(x_0,U) = \frac{1}{2} \Sigma_{k=1}^ {N-1} (x_k^TQ_kx_k + u_k^TR_ku_k) + \frac{1}{2}x_N^TQ_fx_N$$</p>
<p>å…¶ä¸­ä¸‰éƒ¨åˆ†ä¸ºçŠ¶æ€æˆæœ¬ï¼Œæ§åˆ¶æˆæœ¬å’Œç»ˆç‚¹çŠ¶æ€æˆæœ¬ã€‚</p>
<p>åœ¨ç»ˆç«¯æ—¶åˆ» $N$ï¼Œå‰©ä½™æˆæœ¬å³ä¸ºç»ˆç«¯æƒ©ç½šï¼š</p>
<p>$$V_N(x_N) = \frac{1}{2} x_N^T Q_f x_N$$
ä¸ºä¾¿äºé€’æ¨ï¼Œæˆ‘ä»¬å®šä¹‰ï¼š</p>
<p>$$\boldsymbol{S_N = Q_f}$$
æ‰€ä»¥ï¼š</p>
<p>$$V_N(x_N) = \frac{1}{2} x_N^T S_N x_N$$</p>
<h3><span id="kn-1-%E6%97%B6%E5%88%BB%E7%9A%84%E6%9C%80%E4%BC%98%E6%8E%A7%E5%88%B6%E5%BE%8B-u_n-1">$k=N-1$ æ—¶åˆ»çš„æœ€ä¼˜æ§åˆ¶å¾‹ $u^*_{N-1}$</span></h3>
<p>$$V_N(x_N) = \frac{1}{2} x_N^TQ_fx_N=\frac{1}{2}x_N^TS_Nx_N$$</p>
<p>æ ¹æ®è´å°”æ›¼æœ€ä¼˜æ€§åŸç†</p>
<p>$$\begin{aligned}V_{i}(x_{i}) &amp;= \min_{u_{i}} V_{i+1}(x_{i+1})+ \frac{1}{2}u_{i}^TR_{i}u_{i} + \frac{1}{2}x_{i}^TQ_{i}x_{i} \\&amp;=\min_{u_{i}} \frac{1}{2}u_{i}^TR_{i}u_{i} + \frac{1}{2}x_{i}^TQ_{i}x_{i} + \frac{1}{2}(A_{i}x_{i} + B_{i}u_{i})^TS_{i+1}(A_{i}x_{i} + B_{i}u_{i})\\ &amp;=\min_{u_{i}} \frac{1}{2}u_{i}^TR_{i}u_{i} + \frac{1}{2}x_{i}^TQ_{i}x_{i} +\frac{1}{2} x_i^TA^TS_{i+1} Ax_i + \frac{1}{2} u_i^TB_i^TS_{i+1}B_iu_i + x_i^TA_i^TS_{i+1}B_iu_i \\ &amp;=\min_{u_{i}} \frac{1}{2} u_i^T(R_i + B_i^TS_{i+1}B_i)u_i + \frac{1}{2} x_i^T(Q_{i} + A_i^TS_{i+1}A_i)x_i + u_i^T(B_i^TS_{i+1}A_i)x_i \\ \end{aligned}$$</p>
<p>æ¥ä¸‹æ¥æ±‚å¯¼</p>
<p>$$\begin{aligned} \frac{\partial V}{\partial u} &amp;= (R_i + B_i^TS_{i+1}B_i)u_i + (B_i^TS_{i+1}A_i)x_i &amp;= 0 \end{aligned}$$
$$u_i = - (R_i + B_i^TS_{i+1}B_i)^{-1}(B_i^TS_{i+1}A_i)x_i$$
$$u_i = -K_ix_i, \ \ \ \ \ K_i = (R_i + B_i^TS_{i+1}B_i)^{-1}(B_i^TS_{i+1}A_i)$$</p>
<h3><span id="riccati">Riccati</span></h3>
<p>ä»£å…¥æœ€ä¼˜æ§åˆ¶</p>
<p>$$\begin{aligned}V_i(x_i) = &amp;\frac{1}{2} u_i^{*T}(R_i + B_i^TS_{i+1}B_i)u_i^* + \frac{1}{2} x_i^T(Q_{i} + A_i^TS_{i+1}A_i)x_i + u_i^{*T}(B_i^TS_{i+1}A_i)x_i \\ = &amp; \frac{1}{2} x_i^TK_i^T(R_i + B_i^TS_{i+1}B_i)K_ix_i + \frac{1}{2} x_i^T(Q_{i} + A_i^TS_{i+1}A_i)x_i - x_i^TK_i^T(B_i^TS_{i+1}A_i)x_i \\ = &amp; \frac{1}{2} x_i^T (K_i^T(R_i + B_i^TS_{i+1}B_i)K_i + Q_{i} + A_i^TS_{i+1}A_i - 2K_i^T(B_i^TS_{i+1}A_i)) x_i \end{aligned}$$</p>
<h4><span id="%E5%AE%8C%E6%95%B4%E5%BD%A2%E5%BC%8Friccati%E6%96%B9%E7%A8%8B">å®Œæ•´å½¢å¼Riccatiæ–¹ç¨‹</span></h4>
<p>$$\begin{aligned}S_i = &amp; Q_i + A_i^TS_{i+1}A_i - 2K^T(B_i^TS_{i+1}A_i) + K_i^TR_iK_i + K_i^T(B_i^TS_{i+1}B_i)K_i \\ = &amp; Q_i + K_i^TR_iK_i + (A_i - B_iK_i)^TS_{i+1}(A_i - B_iK_i) \end{aligned}$$</p>
<h4><span id="%E6%A0%87%E5%87%86%E7%9A%84-%E7%A6%BB%E6%95%A3%E6%97%B6%E9%97%B4-riccati-%E7%9F%A9%E9%98%B5%E6%96%B9%E7%A8%8B-dare">æ ‡å‡†çš„ ç¦»æ•£æ—¶é—´ Riccati çŸ©é˜µæ–¹ç¨‹ (DARE)ï¼š</span></h4>
<p>å°†Kiä»£å…¥</p>
<p>$$\begin{aligned} S_i =&amp; Q_i + K_i^TR_iK_i + (A_i - B_iK_i)^TS_{i+1}(A_i - B_iK_i) \\ = &amp; Q_i + ((R_i + B_i^TS_{i+1}B_i)^{-1}(B_i^TS_{i+1}A_i)) ^T R_i (R_i + B_i^TS_{i+1}B_i)^{-1}(B_i^TS_{i+1}A_i) + (A_i - B_i(R_i + B_i^TS_{i+1}B_i)^{-1}(B_i^TS_{i+1}A_i))^TS_{i+1}(A_i - B_i(R_i + B_i^TS_{i+1}B_i)^{-1}(B_i^TS_{i+1}A_i)) \\ = &amp; Q_i + A_i^T S_{i+1} A_i - A_i^T S_{i+1} B_i (R_i + B_i^T S_{i+1} B_i)^{-1} B_i^T S_{i+1} A_i \end{aligned}$$</p>
<h1><span id="ilqr">iLQR</span></h1>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹å˜æˆéçº¿æ€§ï¼Œå³
$$x_{k+1} = f(x_k, u _k)$$</p>
<p>ç›®æ ‡å‡½æ•°ä¸º
$$J(x_0,U) = h(x_N) + \Sigma_{k = 0} ^ {N-1} l (x_k,u_k)$$</p>
<h2><span id="%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E7%94%A8ilqr%E5%8E%BB%E4%BC%98%E5%8C%96%E8%BD%A8%E8%BF%B9">å¦‚æœæˆ‘ä»¬ç”¨iLQRå»ä¼˜åŒ–è½¨è¿¹</span></h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç²—èŠ‚è½¨è¿¹$\bold{(\bar x, \bar u)}$ï¼Œæˆ‘ä»¬å¸Œæœ›è®¡ç®—å°çš„æ‰°åŠ¨$\delta x, \delta u$æ¥æ”¹å–„è½¨è¿¹ã€‚</p>
<p>æ‰°åŠ¨ä¸º</p>
<p>$$\begin{aligned} \delta x_k = x_k - \bar x_k\\ \delta u_k = u_k - \bar u_k \end{aligned}$$</p>
<p>æˆ‘ä»¬éœ€è¦å°†éçº¿æ€§æ³°å‹’å±•å¼€ï¼Œå¾—åˆ°çº¿æ€§çš„å±€éƒ¨ç›®æ ‡å‡½æ•°åŠçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚</p>
<p>å¯¹çŠ¶æ€è½¬ç§»æ–¹ç¨‹è¿›è¡Œå±•å¼€</p>
<p>$$\begin{aligned} &amp;x_{k+1} \approx f(\bar x_k, \bar u_k) + \frac{\partial f}{\partial x} |_{\bar k} (x_k -\bar x_k) + \frac{\partial f}{\partial u} | _{\bar k} (u_k - \bar u_k) \\ &amp; A_k = \frac{\partial f}{\partial x} |_{\bar k} \\ &amp; B_k = \frac{\partial f}{\partial u} |_{\bar k} \\ &amp; c_k = f(\bar x_k, \bar u_k) - \bar x_{k+1} \end{aligned}$$</p>
<p>$$\delta x_{k+1} = A_k\delta x_k + B_k \delta u_k + c_k$$</p>
<h2><span id="%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0%E7%9A%84%E4%BA%8C%E6%AC%A1%E5%8C%96%E5%B1%80%E9%83%A8%E6%88%90%E6%9C%AC">ç›®æ ‡å‡½æ•°çš„äºŒæ¬¡åŒ–ï¼ˆå±€éƒ¨æˆæœ¬ï¼‰</span></h2>
<p>$$\delta J = \delta h(x_N) + \Sigma_{k=0}^{N-1} \delta l (x_k, u_k)$$</p>
<h3><span id="%E8%BF%90%E8%A1%8C%E6%88%90%E6%9C%AC">è¿è¡Œæˆæœ¬</span></h3>
<p>å¯¹lè¿›è¡Œæ³°å‹’å±•å¼€ï¼ˆåœ¨ç²—è§£çš„pointä¸Šï¼‰</p>
<p>$$l(x_k, u_k) \approx l(\bar x_k, \bar u_k) + l_x^T\delta x_k + l_u^T\delta u_k + \frac{1}{2} \delta x_k^T l_{xx} \delta x_k + \frac{1}{2} \delta u_k^T l_{uu} \delta u_k + \delta x_k^Tl_{xu}\delta u_k, \ \ \ \ \ \ \ l(\bar x_k, \bar u_k) ä¸ºå¸¸æ•°$$</p>
<h3><span id="%E7%BB%88%E7%AB%AF%E6%88%90%E6%9C%AC">ç»ˆç«¯æˆæœ¬</span></h3>
<p>$$h(x_N) \approx h(\bar x_N) + h^T_x\delta x_N + \frac{1}{2} \delta x_N^T h_{xx}\delta x_N, \ \ \ \ \ \ \ \ h(\bar x_N) ä¸ºå¸¸æ•°$$</p>
<p>æ­¤æ—¶å¯ä»¥å‘ç°ï¼Œä¸LQRç›¸æ¯”ï¼ŒiLQRé™¤äº†äºŒæ¬¡å‹å¤–ï¼Œè¿˜æœ‰çº¿æ€§é¡¹</p>
<h2><span id="ilqr-%E4%B8%8E-lqr-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9%E5%B7%AE%E5%BC%82">iLQR ä¸ LQR çš„çº¿æ€§é¡¹å·®å¼‚</span></h2>
<h3><span id="%F0%9F%94%B9-lqr-linear-quadratic-regulator%E7%BA%AF%E4%BA%8C%E6%AC%A1%E5%9E%8B">ğŸ”¹ LQR (Linear Quadratic Regulator)ï¼šçº¯äºŒæ¬¡å‹</span></h3>
<p><strong>æ ¸å¿ƒç›®æ ‡ï¼š</strong> å°†çŠ¶æ€é©±åŠ¨åˆ°<strong>åŸç‚¹</strong> $\boldsymbol{x}=\mathbf{0}$ã€‚</p>
<h4><span id="a-%E9%9B%B6%E5%8F%82%E8%80%83%E5%92%8C%E9%9B%B6%E6%A2%AF%E5%BA%A6-zero-reference--zero-gradient">A. é›¶å‚è€ƒå’Œé›¶æ¢¯åº¦ (Zero Reference &amp; Zero Gradient)</span></h4>
<p>LQR çš„å±€éƒ¨ç›®æ ‡å‡½æ•°æ˜¯<strong>çº¯äºŒæ¬¡å‹</strong>ï¼Œä¸”å‡è®¾æœ€ä¼˜è½¨è¿¹æ˜¯ $\boldsymbol{x}=\mathbf{0}, \boldsymbol{u}=\mathbf{0}$ã€‚
åœ¨åŸç‚¹ $\boldsymbol{x}=\mathbf{0}$ å¤„ï¼Œæˆæœ¬å‡½æ•°å¯¹äºçŠ¶æ€ $\boldsymbol{x}$ çš„<strong>æ¢¯åº¦</strong>ï¼ˆä¸€é˜¶å¯¼æ•°ï¼‰æ€»æ˜¯ <strong>é›¶</strong>ï¼š</p>
<p>$$\frac{\partial l}{\partial \boldsymbol{x}}\bigg|_{\boldsymbol{x}=\mathbf{0}, \boldsymbol{u}=\mathbf{0}} = \mathbf{0}$$</p>
<h4><span id="b-%E8%B4%9D%E5%B0%94%E6%9B%BC%E6%96%B9%E7%A8%8B%E7%9A%84%E6%80%A7%E8%B4%A8%E7%BA%BF%E6%80%A7%E9%A1%B9%E6%B6%88%E5%A4%B1">B. è´å°”æ›¼æ–¹ç¨‹çš„æ€§è´¨ï¼šçº¿æ€§é¡¹æ¶ˆå¤±</span></h4>
<p>ç”±äºæˆæœ¬å‡½æ•°åœ¨åŸç‚¹æ²¡æœ‰æ¢¯åº¦ï¼Œæ‰€ä»¥å€¼å‡½æ•° $V_k$ åœ¨ $\boldsymbol{x}=\mathbf{0}$ é™„è¿‘ä¹Ÿæ²¡æœ‰æ¢¯åº¦ã€‚
å€¼å‡½æ•° $V_k$ çš„æ³°å‹’å±•å¼€å¼ä¸ºï¼š</p>
<p>$$V_k(\boldsymbol{x}_k) \approx V_k(\mathbf{0}) + \underbrace{\boldsymbol{v}_k^T}_{\text{æ¢¯åº¦}} \boldsymbol{x}_k + \frac{1}{2} \boldsymbol{x}_k^T \boldsymbol{V}_{\boldsymbol{xx}} \boldsymbol{x}_k$$
ç”±äº $V_k(\mathbf{0})=0$ ä¸” $\boldsymbol{v}_k = \frac{\partial V_k}{\partial \boldsymbol{x}}|_{\boldsymbol{x}=\mathbf{0}} = \mathbf{0}$ï¼Œæ‰€æœ‰çº¿æ€§é¡¹éƒ½æ¶ˆå¤±äº†ã€‚</p>
<blockquote>
<p><strong>LQR ç»“è®ºï¼š</strong> å€¼å‡½æ•°æ˜¯<strong>çº¯äºŒæ¬¡å‹</strong>ï¼š</p>
</blockquote>
<p>$$V_k(\boldsymbol{x}_k) = \frac{1}{2} \boldsymbol{x}_k^T \boldsymbol{S}_k \boldsymbol{x}_k$$</p>
<hr>
<h3><span id="%F0%9F%94%B9-ilqr-iterative-lqr%E4%BB%BF%E5%B0%84%E4%BA%8C%E6%AC%A1%E5%9E%8B-affine-quadratic">ğŸ”¹ iLQR (Iterative LQR)ï¼šä»¿å°„äºŒæ¬¡å‹ (Affine Quadratic)</span></h3>
<p><strong>æ ¸å¿ƒç›®æ ‡ï¼š</strong> åœ¨ä¸€æ¡<strong>ä»»æ„åä¹‰è½¨è¿¹</strong> $(\bar{\boldsymbol{x}}, \bar{\boldsymbol{u}})$ é™„è¿‘è¿›è¡Œå±€éƒ¨ä¼˜åŒ–ã€‚</p>
<h4><span id="a-%E8%BD%A8%E8%BF%B9%E5%81%8F%E7%A6%BB%E5%8E%9F%E7%82%B9%E5%AD%98%E5%9C%A8%E9%9D%9E%E9%9B%B6%E6%A2%AF%E5%BA%A6-non-zero-gradient">A. è½¨è¿¹åç¦»åŸç‚¹ï¼Œå­˜åœ¨éé›¶æ¢¯åº¦ (Non-Zero Gradient)</span></h4>
<p>åä¹‰è½¨è¿¹ $(\bar{\boldsymbol{x}}, \bar{\boldsymbol{u}})$ <strong>é€šå¸¸ä¸ç»è¿‡åŸç‚¹</strong>ï¼Œä¸”åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­<strong>é€šå¸¸ä¸æ˜¯æœ€ä¼˜çš„</strong>ã€‚
æˆ‘ä»¬åœ¨åä¹‰ç‚¹ $\bar{\boldsymbol{x}}_k$ å¤„è®¡ç®—å±€éƒ¨æˆæœ¬ $\boldsymbol{\delta l}$ã€‚ç”±äº $\bar{\boldsymbol{x}}_k$ ä¸æ˜¯æœ€ä¼˜è½¨è¿¹ï¼Œå±€éƒ¨æˆæœ¬å‡½æ•° $l(\boldsymbol{x}, \boldsymbol{u})$ åœ¨ $\bar{\boldsymbol{x}}_k$ å¤„å¯¹ $\boldsymbol{x}$ å’Œ $\boldsymbol{u}$ çš„å¯¼æ•°<strong>ä¸ä¸ºé›¶</strong>ï¼š</p>
<p>$$\boldsymbol{l}_{\boldsymbol{x}} = \frac{\partial l}{\partial \boldsymbol{x}}\bigg|_{\bar{k}} \neq \mathbf{0}$$</p>
<p>$$\boldsymbol{l}_{\boldsymbol{u}} = \frac{\partial l}{\partial \boldsymbol{u}}\bigg|_{\bar{k}} \neq \mathbf{0}$$</p>
<h4><span id="b-%E7%BA%BF%E6%80%A7%E9%A1%B9%E7%9A%84%E5%BC%95%E5%85%A5%E9%A9%B1%E5%8A%A8%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B">B. çº¿æ€§é¡¹çš„å¼•å…¥ï¼šé©±åŠ¨ä¼˜åŒ–è¿‡ç¨‹</span></h4>
<p>è¿™äº›éé›¶çš„æ¢¯åº¦ $\boldsymbol{l}_{\boldsymbol{x}}$ å’Œ $\boldsymbol{l}_{\boldsymbol{u}}$ åœ¨ Q å‡½æ•° $\mathcal{Q}_k$ çš„æ³°å‹’å±•å¼€ä¸­å¼•å…¥äº†<strong>çº¿æ€§åˆ†é‡</strong> $\boldsymbol{q}$ å’Œ $\boldsymbol{r}$ï¼š</p>
<p>$$\mathcal{Q}_k \approx \dots + \underbrace{\boldsymbol{q}^T \boldsymbol{\delta x}_k}_{\text{éé›¶}} + \underbrace{\boldsymbol{r}^T \boldsymbol{\delta u}_k}_{\text{éé›¶}} + \frac{1}{2} \boldsymbol{\delta x}_k^T \boldsymbol{Q} \boldsymbol{\delta x}_k + \dots$$
ç”±äº $\boldsymbol{q}$ å’Œ $\boldsymbol{r}$ ä¸ä¸ºé›¶ï¼Œé€šè¿‡è´å°”æ›¼æ–¹ç¨‹é€†å‘é€’æ¨å¾—åˆ°çš„å€¼å‡½æ•° $V_k$ çš„æ¢¯åº¦ $\boldsymbol{v}_k$ <strong>ä¹Ÿä¸ä¸ºé›¶</strong>ï¼š</p>
<p>$$\boldsymbol{v}_k = \boldsymbol{q} - \boldsymbol{M} \boldsymbol{R}^{-1} \boldsymbol{r} \neq \mathbf{0}$$</p>
<blockquote>
<p><strong>iLQR ç»“è®ºï¼š</strong> å€¼å‡½æ•°æ˜¯<strong>ä»¿å°„äºŒæ¬¡å‹</strong>ï¼ˆåŒ…å«çº¿æ€§é¡¹ï¼‰ï¼š</p>
</blockquote>
<p>$$V_k(\boldsymbol{\delta x}_k) \approx \text{const} + \underbrace{\boldsymbol{v}_k^T \boldsymbol{\delta x}_k}_{\text{éé›¶çº¿æ€§é¡¹}} + \frac{1}{2} \boldsymbol{\delta x}_k^T \boldsymbol{V}_{\boldsymbol{xx}} \boldsymbol{\delta x}_k$$</p>
<hr>
<h2><span id="%F0%9F%8E%AF-%E6%80%BB%E7%BB%93%E7%BA%BF%E6%80%A7%E9%A1%B9%E7%9A%84%E4%BD%9C%E7%94%A8">ğŸ¯ æ€»ç»“ï¼šçº¿æ€§é¡¹çš„ä½œç”¨</span></h2>
<p>iLQR ä¸­çš„éé›¶çº¿æ€§é¡¹ $\boldsymbol{v}_k^T \boldsymbol{\delta x}_k$ æ„å‘³ç€æœ€ä¼˜å€¼å‡½æ•°åœ¨å½“å‰åä¹‰ç‚¹å¤„æœ‰ä¸€ä¸ª<strong>éé›¶çš„æ–œç‡</strong>ã€‚</p>
<p>è¿™ä¸ªæ–œç‡å°±æ˜¯<strong>ä¼˜åŒ–è¿‡ç¨‹çš„é©±åŠ¨åŠ›</strong>ï¼šå®ƒå‘Šè¯‰æˆ‘ä»¬æ²¿ç€å“ªä¸ªæ–¹å‘ï¼ˆå³æœ€ä¼˜åé¦ˆæ§åˆ¶ $\boldsymbol{\delta u}_k^*$ï¼‰ç§»åŠ¨ $\boldsymbol{\delta x}$ å¯ä»¥è·å¾—<strong>æœ€å¤§çš„æˆæœ¬ä¸‹é™</strong>ï¼Œä»è€Œä¸æ–­åœ°å°†åä¹‰è½¨è¿¹æ¨å‘å±€éƒ¨æœ€ä¼˜ã€‚</p>
<h2><span id="ilqr%E7%9A%84%E6%9C%80%E4%BC%98%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0">iLQRçš„æœ€ä¼˜ç›®æ ‡å‡½æ•°</span></h2>
<p>ç»ˆç«¯ï¼š
åœ¨k = N æ—¶ï¼Œæœ€ä¼˜æœªæ¥æˆæœ¬æ˜¯ç»ˆç«¯æˆæœ¬</p>
<p>$$V_N(x_N) = h (x_N)$$
å°†å…¶æ³°å‹’å±•å¼€ï¼Œå»æ‰å¸¸æ•°é¡¹ï¼Œå¯ä»¥å¾—åˆ°</p>
<p>$$V_N(\delta x_N) \approx h^T_x\delta x_N + \frac{1}{2} \delta x^T _N h_{xx} \delta x_N$$</p>
<p>ä¸€èˆ¬ï¼š</p>
<p>$$V_k(\delta x_k) = C_k + v_k^T\delta x_k + \frac{1}{2}\delta x^T_kV_{xx,k} \delta x_k$$</p>
<p>å…¶ä¸­ï¼Œåœ¨ç»ˆç«¯çš„æ—¶å€™</p>
<p>$$v_N = h_x,\ \ \ V_{xx,N} = h_{xx}$$</p>
<h3><span id="%E9%80%92%E6%8E%A8%E8%BF%87%E7%A8%8Bk--1------k">é€’æ¨è¿‡ç¨‹k + 1 ----&gt; kï¼š</span></h3>
<p>$$Q_k(\delta x_k, \delta u_k) = l (x_k,u_k) + V_{k+1}(x_{k+1})$$</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°† $\mathcal{Q}_k$ åœ¨åä¹‰è½¨è¿¹ç‚¹ $(\bar{\boldsymbol{x}}_k, \bar{\boldsymbol{u}}_k)$ é™„è¿‘å±•å¼€ï¼Œå¾—åˆ°ä¸€ä¸ªå…³äºæ‰°åŠ¨ $(\boldsymbol{\delta x}_k, \boldsymbol{\delta u}_k)$ çš„<strong>äºŒæ¬¡è¿‘ä¼¼</strong>ï¼š</p>
<p>$$\mathcal{Q}_k \approx \text{å¸¸æ•°} + \boldsymbol{q}^T \boldsymbol{\delta x}_k + \boldsymbol{r}^T \boldsymbol{\delta u}_k + \frac{1}{2} \boldsymbol{\delta x}_k^T \boldsymbol{Q} \boldsymbol{\delta x}_k + \frac{1}{2} \boldsymbol{\delta u}_k^T \boldsymbol{R} \boldsymbol{\delta u}_k + \boldsymbol{\delta x}_k^T \boldsymbol{M} \boldsymbol{\delta u}_k$$</p>
<p><strong>åˆ†åˆ«å±•å¼€ $l$ å’Œ $V_{k+1}$ï¼Œç„¶åå°†å®ƒä»¬çš„ç³»æ•°åˆæˆ</strong>ã€‚</p>
<h4><span id="2-%E5%B7%B2%E7%9F%A5%E4%BF%A1%E6%81%AF-%E8%BE%93%E5%85%A5">2. å·²çŸ¥ä¿¡æ¯ (è¾“å…¥)</span></h4>
<p>åœ¨ $k$ æ—¶åˆ»çš„é€†å‘é€’æ¨ä¸­ï¼Œæˆ‘ä»¬<strong>å·²çŸ¥</strong>ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ol>
<li>
<p><strong>ç¬æ—¶æˆæœ¬ $l$ çš„å¯¼æ•°ï¼š</strong>
$\boldsymbol{l}_{\boldsymbol{x}}, \boldsymbol{l}_{\boldsymbol{u}}$ (æ¢¯åº¦)
$\boldsymbol{l}_{\boldsymbol{xx}}, \boldsymbol{l}_{\boldsymbol{uu}}, \boldsymbol{l}_{\boldsymbol{xu}}$ (Hessian)</p>
</li>
<li>
<p><strong>æœªæ¥æˆæœ¬ $V_{k+1}$ çš„è¿‘ä¼¼ï¼š</strong>
$\boldsymbol{v}_{k+1}$ ($V_{k+1}$ å¯¹ $\boldsymbol{\delta x}_{k+1}$ çš„æ¢¯åº¦)
$\boldsymbol{V}_{\boldsymbol{xx}, k+1}$ ($V_{k+1}$ å¯¹ $\boldsymbol{\delta x}_{k+1}$ çš„ Hessian)</p>
</li>
<li>
<p><strong>çº¿æ€§åŒ–åŠ¨åŠ›å­¦ï¼š</strong>
$\boldsymbol{\delta x}_{k+1} = \boldsymbol{A}_k \boldsymbol{\delta x}_k + \boldsymbol{B}_k \boldsymbol{\delta u}_k + \boldsymbol{c}_k$</p>
</li>
</ol>
<h4><span id="%E7%9E%AC%E6%97%B6%E6%88%90%E6%9C%AC-l-%E7%9A%84%E5%B1%95%E5%BC%80-%E7%9B%B4%E6%8E%A5%E5%B1%95%E5%BC%80">ç¬æ—¶æˆæœ¬ $l$ çš„å±•å¼€ (ç›´æ¥å±•å¼€)</span></h4>
<p>æˆ‘ä»¬é¦–å…ˆå¯¹ $l(\boldsymbol{x}_k, \boldsymbol{u}_k)$ åœ¨ $(\bar{\boldsymbol{x}}_k, \bar{\boldsymbol{u}}_k)$ é™„è¿‘è¿›è¡ŒäºŒé˜¶æ³°å‹’å±•å¼€ï¼š</p>
<p>$$l(\boldsymbol{x}_k, \boldsymbol{u}_k) \approx l(\bar{\boldsymbol{x}}_k, \bar{\boldsymbol{u}}_k) + \boldsymbol{l}_{\boldsymbol{x}}^T \boldsymbol{\delta x}_k + \boldsymbol{l}_{\boldsymbol{u}}^T \boldsymbol{\delta u}_k + \frac{1}{2} \boldsymbol{\delta x}_k^T \boldsymbol{l}_{\boldsymbol{xx}} \boldsymbol{\delta x}_k + \frac{1}{2} \boldsymbol{\delta u}_k^T \boldsymbol{l}_{\boldsymbol{uu}} \boldsymbol{\delta u}_k + \boldsymbol{\delta x}_k^T \boldsymbol{l}_{\boldsymbol{xu}} \boldsymbol{\delta u}_k$$</p>
<h4><span id="%E6%9C%AA%E6%9D%A5%E6%88%90%E6%9C%AC-v_k1-%E7%9A%84%E5%B1%95%E5%BC%80-%E9%93%BE%E5%BC%8F%E6%B3%95%E5%88%99">æœªæ¥æˆæœ¬ $V_{k+1}$ çš„å±•å¼€ (é“¾å¼æ³•åˆ™)</span></h4>
<p>æˆ‘ä»¬å¿…é¡»å°† $V_{k+1}$ï¼ˆå®ƒæ˜¯ $\boldsymbol{\delta x}_{k+1}$ çš„å‡½æ•°ï¼‰è½¬æ¢ä¸º $(\boldsymbol{\delta x}_k, \boldsymbol{\delta u}_k)$ çš„å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬ä» $V_{k+1}$ çš„å·²çŸ¥è¿‘ä¼¼å¼€å§‹ï¼š</p>
<p>$$V_{k+1}(\boldsymbol{\delta x}_{k+1}) \approx \text{å¸¸æ•°} + \boldsymbol{v}_{k+1}^T \boldsymbol{\delta x}_{k+1} + \frac{1}{2} \boldsymbol{\delta x}_{k+1}^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{\delta x}_{k+1}$$</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†çº¿æ€§åŒ–åŠ¨åŠ›å­¦ $\boldsymbol{\delta x}_{k+1} = \boldsymbol{A}_k \boldsymbol{\delta x}_k + \boldsymbol{B}_k \boldsymbol{\delta u}_k + \boldsymbol{c}_k$ ä»£å…¥ä¸Šå¼ã€‚</p>
<h5><span id="v_k1-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9%E5%B1%95%E5%BC%80">$V_{k+1}$ çš„çº¿æ€§é¡¹å±•å¼€</span></h5>
<p>å°† $\boldsymbol{\delta x}_{k+1}$ ä»£å…¥ $\boldsymbol{v}_{k+1}^T \boldsymbol{\delta x}_{k+1}$ï¼š</p>
<p>$$\boldsymbol{v}_{k+1}^T \boldsymbol{\delta x}_{k+1} = \boldsymbol{v}_{k+1}^T (\boldsymbol{A}_k \boldsymbol{\delta x}_k + \boldsymbol{B}_k \boldsymbol{\delta u}_k + \boldsymbol{c}_k)$$
$$\boldsymbol{v}_{k+1}^T \boldsymbol{\delta x}_{k+1} = \underbrace{(\boldsymbol{A}_k^T \boldsymbol{v}_{k+1})^T \boldsymbol{\delta x}_k}_{\text{å¯¹ } \boldsymbol{\delta x}_k \text{ çº¿æ€§}} + \underbrace{(\boldsymbol{B}_k^T \boldsymbol{v}_{k+1})^T \boldsymbol{\delta u}_k}_{\text{å¯¹ } \boldsymbol{\delta u}_k \text{ çº¿æ€§}} + \underbrace{\boldsymbol{v}_{k+1}^T \boldsymbol{c}_k}_{\text{å¸¸æ•°}}$$</p>
<h5><span id="v_k1-%E7%9A%84%E4%BA%8C%E6%AC%A1%E9%A1%B9%E5%B1%95%E5%BC%80">$V_{k+1}$ çš„äºŒæ¬¡é¡¹å±•å¼€</span></h5>
<p>å°† $\boldsymbol{\delta x}_{k+1}$ ä»£å…¥ $\frac{1}{2} \boldsymbol{\delta x}_{k+1}^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{\delta x}_{k+1}$ï¼š</p>
<p>$$\frac{1}{2} (\boldsymbol{A}_k \boldsymbol{\delta x}_k + \boldsymbol{B}_k \boldsymbol{\delta u}_k + \boldsymbol{c}_k)^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} (\boldsymbol{A}_k \boldsymbol{\delta x}_k + \boldsymbol{B}_k \boldsymbol{\delta u}_k + \boldsymbol{c}_k)$$</p>
<p>å±•å¼€è¿™ä¸ªäºŒæ¬¡å‹ï¼ˆæˆ‘ä»¬åªä¿ç•™åˆ°äºŒé˜¶ï¼Œå¿½ç•¥ $\boldsymbol{c}_k$ çš„äºŒæ¬¡é¡¹ï¼Œå› ä¸ºå®ƒåªæ˜¯å¸¸æ•°ï¼‰ï¼š</p>
<p><strong>$\boldsymbol{\delta x}_k$ çš„äºŒæ¬¡é¡¹:</strong> $\frac{1}{2} (\boldsymbol{A}_k \boldsymbol{\delta x}_k)^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} (\boldsymbol{A}_k \boldsymbol{\delta x}_k) = \frac{1}{2} \boldsymbol{\delta x}_k^T (\boldsymbol{A}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{A}_k) \boldsymbol{\delta x}_k$
<strong>$\boldsymbol{\delta u}_k$ çš„äºŒæ¬¡é¡¹:</strong> $\frac{1}{2} (\boldsymbol{B}_k \boldsymbol{\delta u}_k)^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} (\boldsymbol{B}_k \boldsymbol{\delta u}_k) = \frac{1}{2} \boldsymbol{\delta u}_k^T (\boldsymbol{B}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{B}_k) \boldsymbol{\delta u}_k$
<strong>äº¤å‰é¡¹ ($\boldsymbol{\delta x}_k, \boldsymbol{\delta u}_k$):</strong> $\boldsymbol{\delta x}_k^T (\boldsymbol{A}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{B}_k) \boldsymbol{\delta u}_k$
<strong>çº¿æ€§é¡¹ (æ¥è‡ª $\boldsymbol{c}_k$):</strong> $\boldsymbol{\delta x}_k^T (\boldsymbol{A}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{c}_k) + \boldsymbol{\delta u}_k^T (\boldsymbol{B}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{c}_k)$</p>
<p><em>(æ³¨ï¼šiLQR ç®€åŒ–å¿½ç•¥äº† $f$ çš„äºŒé˜¶å¯¼æ•° $\boldsymbol{f}_{\boldsymbol{xx}}, \boldsymbol{f}_{\boldsymbol{uu}}$ï¼Œå®ƒä»¬æœ¬åº”å‡ºç°åœ¨ $V_{k+1}$ çš„å±•å¼€ä¸­ã€‚)</em></p>
<h3><span id="%E5%90%88%E6%88%90-q-%E5%87%BD%E6%95%B0%E7%B3%BB%E6%95%B0">åˆæˆ Q å‡½æ•°ç³»æ•°</span></h3>
<p>ç°åœ¨æˆ‘ä»¬å°†<strong>ç¬¬ 1 éƒ¨åˆ†</strong> ($l$ çš„å±•å¼€) å’Œ<strong>ç¬¬ 2 éƒ¨åˆ†</strong> ($V_{k+1}$ çš„å±•å¼€) çš„åŒç±»é¡¹ç³»æ•°ç›¸åŠ ï¼Œå¾—åˆ° $\mathcal{Q}_k$ çš„æœ€ç»ˆç³»æ•°ã€‚</p>
<h4><span id="%E6%A2%AF%E5%BA%A6-boldsymbolq-%E5%AF%B9-boldsymboldelta-x_k-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9">æ¢¯åº¦ $\boldsymbol{q}$ (å¯¹ $\boldsymbol{\delta x}_k$ çš„çº¿æ€§é¡¹)</span></h4>
<p>$$\boldsymbol{q} = \frac{\partial \mathcal{Q}_k}{\partial \boldsymbol{\delta x}_k} = \underbrace{\boldsymbol{l}_{\boldsymbol{x}}}_{\text{æ¥è‡ª } l} + \underbrace{\boldsymbol{A}_k^T \boldsymbol{v}_{k+1}}_{\text{æ¥è‡ª } V_{k+1} \text{ çº¿æ€§é¡¹}} + \underbrace{\boldsymbol{A}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{c}_k}_{\text{æ¥è‡ª } V_{k+1} \text{ äºŒæ¬¡é¡¹ä¸ } \boldsymbol{c}_k \text{ äº¤å‰}}$$</p>
<h4><span id="%E6%A2%AF%E5%BA%A6-boldsymbolr-%E5%AF%B9-boldsymboldelta-u_k-%E7%9A%84%E7%BA%BF%E6%80%A7%E9%A1%B9">æ¢¯åº¦ $\boldsymbol{r}$ (å¯¹ $\boldsymbol{\delta u}_k$ çš„çº¿æ€§é¡¹)</span></h4>
<p>$$\boldsymbol{r} = \frac{\partial \mathcal{Q}_k}{\partial \boldsymbol{\delta u}_k} = \underbrace{\boldsymbol{l}_{\boldsymbol{u}}}_{\text{æ¥è‡ª } l} + \underbrace{\boldsymbol{B}_k^T \boldsymbol{v}_{k+1}}_{\text{æ¥è‡ª } V_{k+1} \text{ çº¿æ€§é¡¹}} + \underbrace{\boldsymbol{B}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{c}_k}_{\text{æ¥è‡ª } V_{k+1} \text{ äºŒæ¬¡é¡¹ä¸ } \boldsymbol{c}_k \text{ äº¤å‰}}$$</p>
<h4><span id="hessian-boldsymbolq-%E5%AF%B9-boldsymboldelta-x_k-boldsymboldelta-x_k-%E7%9A%84%E4%BA%8C%E6%AC%A1%E9%A1%B9">Hessian $\boldsymbol{Q}$ (å¯¹ $\boldsymbol{\delta x}_k, \boldsymbol{\delta x}_k$ çš„äºŒæ¬¡é¡¹)</span></h4>
<p>$$\boldsymbol{Q} = \frac{\partial^2 \mathcal{Q}_k}{\partial \boldsymbol{\delta x}_k^2} = \underbrace{\boldsymbol{l}_{\boldsymbol{xx}}}_{\text{æ¥è‡ª } l} + \underbrace{\boldsymbol{A}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{A}_k}_{\text{æ¥è‡ª } V_{k+1} \text{ äºŒæ¬¡é¡¹}}$$</p>
<h4><span id="hessian-boldsymbolr-%E5%AF%B9-boldsymboldelta-u_k-boldsymboldelta-u_k-%E7%9A%84%E4%BA%8C%E6%AC%A1%E9%A1%B9">Hessian $\boldsymbol{R}$ (å¯¹ $\boldsymbol{\delta u}_k, \boldsymbol{\delta u}_k$ çš„äºŒæ¬¡é¡¹)</span></h4>
<p>$$\boldsymbol{R} = \frac{\partial^2 \mathcal{Q}_k}{\partial \boldsymbol{\delta u}_k^2} = \underbrace{\boldsymbol{l}_{\boldsymbol{uu}}}_{\text{æ¥è‡ª } l} + \underbrace{\boldsymbol{B}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{B}_k}_{\text{æ¥è‡ª } V_{k+1} \text{ äºŒæ¬¡é¡¹}}$$</p>
<h4><span id="hessian-boldsymbolm-%E5%AF%B9-boldsymboldelta-x_k-boldsymboldelta-u_k-%E7%9A%84%E4%BA%A4%E5%8F%89%E9%A1%B9">Hessian $\boldsymbol{M}$ (å¯¹ $\boldsymbol{\delta x}_k, \boldsymbol{\delta u}_k$ çš„äº¤å‰é¡¹)</span></h4>
<p>$$\boldsymbol{M} = \frac{\partial^2 \mathcal{Q}_k}{\partial \boldsymbol{\delta x}_k \partial \boldsymbol{\delta u}_k} = \underbrace{\boldsymbol{l}_{\boldsymbol{xu}}}_{\text{æ¥è‡ª } l} + \underbrace{\boldsymbol{A}_k^T \boldsymbol{V}_{\boldsymbol{xx}, k+1} \boldsymbol{B}_k}_{\text{æ¥è‡ª } V_{k+1} \text{ äºŒæ¬¡é¡¹}}$$</p>
<h2><span id="%E6%B1%82%E8%A7%A3%E6%9C%80%E4%BC%98%E6%8E%A7%E5%88%B6%E6%89%B0%E5%8A%A8">æ±‚è§£æœ€ä¼˜æ§åˆ¶æ‰°åŠ¨</span></h2>
<p>æ±‚å¯¼ï¼Œå°±æ˜¯æ±‚å¯¼ï¼</p>
<p>$$\mathcal{Q}_k \approx \text{å¸¸æ•°} + \boldsymbol{q}^T \boldsymbol{\delta x}_k + \boldsymbol{r}^T \boldsymbol{\delta u}_k + \frac{1}{2} \boldsymbol{\delta x}_k^T \boldsymbol{Q} \boldsymbol{\delta x}_k + \frac{1}{2} \boldsymbol{\delta u}_k^T \boldsymbol{R} \boldsymbol{\delta u}_k + \boldsymbol{\delta x}_k^T \boldsymbol{M} \boldsymbol{\delta u}_k$$
$$\frac{\partial Q_k}{\partial \delta u_k} = r + R\delta u_k + M^T\delta x_k$$
$$\delta u_k^* = - R^{-1}r - R^{-1}M^T\delta x_k = k_k + K_k\delta x_k$$</p>
<p>$$\delta u_k = u_k - \bar u_k$$</p>
<p>å‰é¦ˆï¼š$k_k = - R^{-1}r$ï¼ŒæŠµæ¶ˆæˆæœ¬çš„æ¢¯åº¦ $\boldsymbol{r}$ã€‚è¿™æ˜¯æ¨åŠ¨è½¨è¿¹å‘æœ€ä¼˜æ–¹å‘ç§»åŠ¨çš„ä¸»è¦åŠ›é‡ã€‚</p>
<p>åé¦ˆï¼š$K_k = - R^{-1}M^T$ï¼Œå®æ—¶ä¿®æ­£çŠ¶æ€ $\boldsymbol{\delta x}_k$ çš„åå·®ã€‚</p>
<h2><span id="%E9%80%92%E6%8E%A8%E8%BF%87%E7%A8%8B-k-k-1">é€’æ¨è¿‡ç¨‹ k-&gt;k-1</span></h2>
<ol>
<li>è®¡ç®—$q_{k}$,$r_{k}$,$Q_{k}$,$R_{k}$,$M_{k}$ï¼Œå¾—åˆ°å‰é¦ˆå’Œåé¦ˆç³»æ•°</li>
<li>è®¡ç®—å‰é¦ˆï¼š$k_k$å’Œåé¦ˆï¼š$K_k$</li>
<li>æ›´æ–°hessian$V_{xx,k}$å’Œæ¢¯åº¦$v_k$ã€‚å› ä¸ºæ¥ä¸‹æ¥è®¡ç®—k-1æ—¶åˆ»æ—¶çš„qä¹‹ç±»çš„ç³»æ•°éœ€è¦ç”¨åˆ°è¿™ä¸¤ä¸ªé‡ã€‚</li>
</ol>
<p>$$\boldsymbol{v}_k = \boldsymbol{q}_k + \boldsymbol{K}_k^T \boldsymbol{r}_k + \boldsymbol{K}_k^T \boldsymbol{R}_k \boldsymbol{k}_k + \boldsymbol{M}_k \boldsymbol{k}_k$$
$$\boldsymbol{V}_{\boldsymbol{xx}, k} = \boldsymbol{Q}_k + \boldsymbol{K}_k^T \boldsymbol{R}_k \boldsymbol{K}_k + \boldsymbol{M}_k \boldsymbol{K}_k + \boldsymbol{K}_k^T \boldsymbol{M}_k^T$$
4. è®¡ç®—$q_{k-1}$,$r_{k-1}$,$Q_{k-1}$,$R_{k-1}$,$M_{k-1}$
5. è®¡ç®—å‰é¦ˆï¼š$k_{k-1}$å’Œåé¦ˆï¼š$K_{k-1}$</p>
<h2><span id="%E5%89%8D%E5%90%91%E6%9B%B4%E6%96%B0">å‰å‘æ›´æ–°</span></h2>
<p><strong>ç›®çš„ï¼š</strong> åˆ©ç”¨åˆšåˆšè®¡ç®—å‡ºçš„ $(\boldsymbol{k}, \boldsymbol{K})$ ç­–ç•¥ï¼Œç”Ÿæˆä¸€æ¡<strong>æ–°çš„ã€æˆæœ¬æ›´ä½</strong>çš„è½¨è¿¹ $(\boldsymbol{x}_{\text{new}}, \boldsymbol{u}_{\text{new}})$ã€‚</p>
<h3><span id="a-%E6%AD%A5%E9%95%BF%E4%B8%8E%E7%BA%BF%E6%80%A7%E6%90%9C%E7%B4%A2-line-search">A. æ­¥é•¿ä¸çº¿æ€§æœç´¢ (Line Search)</span></h3>
<p>æˆ‘ä»¬<strong>ä¸èƒ½</strong>ç®€å•åœ°å°† $\boldsymbol{\delta u}_k^* = \boldsymbol{k}_k + \boldsymbol{K}_k \boldsymbol{\delta x}_k$ å®Œå…¨åº”ç”¨ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆï¼Ÿ</strong> å› ä¸ºæˆ‘ä»¬çš„ $(\boldsymbol{k}, \boldsymbol{K})$ ç­–ç•¥æ˜¯åŸºäºä¸€ä¸ª<strong>å±€éƒ¨çº¿æ€§è¿‘ä¼¼</strong> $f$ è®¡ç®—å‡ºæ¥çš„ã€‚å¦‚æœ $f$ çš„éçº¿æ€§ç¨‹åº¦å¾ˆé«˜ï¼Œåº”ç”¨<strong>å®Œæ•´</strong>çš„ $\boldsymbol{\delta u}_k^*$ ï¼ˆå³ $\alpha=1$ï¼‰å¯èƒ½ä¼šå¯¼è‡´ $\boldsymbol{x}_{\text{new}}$ ä¸¥é‡åç¦»é¢„æœŸï¼Œæ–°è½¨è¿¹çš„<strong>æ€»æˆæœ¬ $J$ åè€Œå¯èƒ½ä¸Šå‡</strong>ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿æ”¶æ•›ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ª<strong>æ­¥é•¿ $\alpha$</strong> (Alpha)ï¼Œ$\alpha \in (0, 1]$ã€‚</p>
<h3><span id="b-%E5%89%8D%E5%90%91%E6%9B%B4%E6%96%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%AD%A5%E9%AA%A4">B. å‰å‘æ›´æ–°çš„æ‰§è¡Œæ­¥éª¤</span></h3>
<ol>
<li>
<p><strong>åˆå§‹åŒ–ï¼š</strong></p>
<ul>
<li>è®¾ç½®æ–°è½¨è¿¹çš„èµ·ç‚¹ï¼š$\boldsymbol{x}_{\text{new}, 0} = \boldsymbol{x}_0$ (åˆå§‹çŠ¶æ€å§‹ç»ˆä¸å˜)ã€‚</li>
<li>å°è¯•ä¸€ä¸ªåˆå§‹æ­¥é•¿ï¼Œä¾‹å¦‚ $\alpha = 1.0$ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ¨¡æ‹Ÿï¼ˆRolloutï¼‰ï¼š</strong>
ä» $k=0$ åˆ° $N-1$ å¾ªç¯ï¼š</p>
<p><strong>è®¡ç®—çŠ¶æ€åå·®ï¼š</strong></p>
</li>
</ol>
<p>$$\boldsymbol{\delta x}_k = \boldsymbol{x}_{\text{new}, k} - \bar{\boldsymbol{x}}_k$$
(æ³¨æ„ï¼šè¿™é‡Œæ˜¯ç”¨<strong>æ–°</strong>çŠ¶æ€ $\boldsymbol{x}_{\text{new}, k}$ å’Œ<strong>æ—§</strong>åä¹‰çŠ¶æ€ $\bar{\boldsymbol{x}}_k$ è®¡ç®—åå·®ã€‚)</p>
<pre><code>**è®¡ç®—æ–°çš„æ§åˆ¶ $\boldsymbol\{u\}\_\{\text\{new\}, k\}$ï¼š**
</code></pre>
<p>$$\boldsymbol{u}_{\text{new}, k} = \bar{\boldsymbol{u}}_k + \alpha \cdot \boldsymbol{k}_k + \boldsymbol{K}_k \boldsymbol{\delta x}_k$$
(è¿™æ˜¯å…³é”®ï¼š<strong>å‰é¦ˆé¡¹ $\boldsymbol{k}_k$ è¢« $\alpha$ ç¼©æ”¾</strong>ï¼Œè€Œåé¦ˆé¡¹ $\boldsymbol{K}_k$ é€šå¸¸ä¸ç¼©æ”¾æˆ–ä¸ $\alpha$ ä¸€èµ·ç¼©æ”¾ï¼Œå…·ä½“å–å†³äºå®ç°ã€‚)</p>
<pre><code>**ç§¯åˆ†ï¼ˆä½¿ç”¨çœŸå®çš„éçº¿æ€§åŠ¨åŠ›å­¦ $f$ï¼‰ï¼š**
</code></pre>
<p>$$\boldsymbol{x}_{\text{new}, k+1} = f(\boldsymbol{x}_{\text{new}, k}, \boldsymbol{u}_{\text{new}, k})$$</p>
<ol start="3">
<li>
<p><strong>è¯„ä¼°æˆæœ¬ï¼š</strong>
è®¡ç®—æ–°è½¨è¿¹ $(\boldsymbol{x}_{\text{new}}, \boldsymbol{u}_{\text{new}})$ çš„<strong>çœŸå®æ€»æˆæœ¬</strong> $J_{\text{new}}$ (ä½¿ç”¨<strong>åŸå§‹éçº¿æ€§æˆæœ¬å‡½æ•°</strong> $l$ å’Œ $h$)ã€‚</p>
</li>
<li>
<p><strong>æ¥å—æˆ–æ‹’ç» (Line Search)ï¼š</strong>
<strong>å¦‚æœ $J_{\text{new}} &lt; J_{\text{old}}$ (æˆæœ¬ä¸‹é™)ï¼š</strong>
<strong>æ¥å—ï¼</strong> æ–°è½¨è¿¹ $(\boldsymbol{x}_{\text{new}}, \boldsymbol{u}_{\text{new}})$ ä¼˜äºæ—§è½¨è¿¹ã€‚
<strong>å¦‚æœ $J_{\text{new}} \ge J_{\text{old}}$ (æˆæœ¬ä¸Šå‡æˆ–ä¸å˜)ï¼š</strong>
<strong>æ‹’ç»ï¼</strong> æ­¥å­è¿ˆå¾—å¤ªå¤§äº†ã€‚
<strong>å‡å° $\alpha$</strong> (ä¾‹å¦‚ $\alpha = \alpha / 2$)ã€‚
<strong>è¿”å›æ­¥éª¤ 2</strong>ï¼Œç”¨æ›´å°çš„ $\alpha$ é‡æ–°å°è¯•æ•´ä¸ªå‰å‘æ¨¡æ‹Ÿã€‚</p>
</li>
</ol>
<h2><span id="%E8%BF%AD%E4%BB%A3%E4%B8%8E%E6%94%B6%E6%95%9B">è¿­ä»£ä¸æ”¶æ•›</span></h2>
<p><strong>å‰å‘æ›´æ–°</strong>æˆåŠŸæ‰¾åˆ°ä¸€æ¡æˆæœ¬æ›´ä½çš„è½¨è¿¹ $(\boldsymbol{x}_{\text{new}}, \boldsymbol{u}_{\text{new}})$ åï¼š</p>
<ol>
<li>
<p><strong>æ›´æ–°åä¹‰è½¨è¿¹ï¼š</strong>
å°† $(\boldsymbol{x}_{\text{new}}, \boldsymbol{u}_{\text{new}})$ è®¾ä¸º<strong>ä¸‹ä¸€æ¬¡è¿­ä»£</strong>çš„<strong>åä¹‰è½¨è¿¹</strong> $(\bar{\boldsymbol{x}}, \bar{\boldsymbol{u}})$ã€‚</p>
</li>
<li>
<p><strong>é‡å¤ï¼š</strong>
è¿”å›<strong>é€†å‘é€’æ¨ (Backward Pass)</strong> é˜¶æ®µï¼Œåœ¨æ–°çš„ $(\bar{\boldsymbol{x}}, \bar{\boldsymbol{u}})$ é™„è¿‘é‡æ–°è®¡ç®— $\boldsymbol{A}_k, \boldsymbol{B}_k, l_{\boldsymbol{x}}, l_{\boldsymbol{xx}} \dots$ å¹¶æ±‚è§£æ–°çš„ $(\boldsymbol{k}, \boldsymbol{K})$ ç­–ç•¥ã€‚</p>
</li>
<li>
<p><strong>æ”¶æ•›ï¼š</strong>
å½“æˆæœ¬ $J$ çš„æ”¹å–„é‡éå¸¸å°ï¼ˆä½äºæŸä¸ªé˜ˆå€¼ $\epsilon$ï¼‰æ—¶ï¼Œç®—æ³•æ”¶æ•›ï¼Œå½“å‰çš„ $(\bar{\boldsymbol{x}}, \bar{\boldsymbol{u}})$ å³ä¸º<strong>å±€éƒ¨æœ€ä¼˜è½¨è¿¹</strong>ã€‚</p>
</li>
</ol>
<h3><span id="%E4%B8%80%E4%BA%9B%E7%96%91%E6%83%91%E4%B8%8E%E8%A7%A3%E7%AD%94">ä¸€äº›ç–‘æƒ‘ä¸è§£ç­”</span></h3>
<h4><span id="%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%AE%A1%E7%AE%97ck%E5%91%A2">ä»€ä¹ˆæ—¶å€™è®¡ç®—ckå‘¢ï¼Ÿ</span></h4>
<p>$\boldsymbol{c}_k$ çš„è®¡ç®—å‘ç”Ÿåœ¨æ¯æ¬¡è¿­ä»£çš„å¼€å§‹ï¼ˆå‰å‘æ›´æ–°é˜¶æ®µï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">é˜¶æ®µ</th>
<th style="text-align:left">åŠ¨ä½œ</th>
<th style="text-align:left">$\boldsymbol{c}_k$ çš„çŠ¶æ€</th>
<th style="text-align:left">è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ï¼ˆ1ï¼‰åˆå§‹åŒ–</strong></td>
<td style="text-align:left">é¦–æ¬¡ç²—ç•¥çŒœæµ‹ $\boldsymbol{u}_{\text{bar}}$ï¼Œè®¡ç®—åˆå§‹ $\boldsymbol{x}_{\text{bar}}$ã€‚</td>
<td style="text-align:left"><strong>$\boldsymbol{c}_k \neq 0$</strong> (å¦‚æœ $\boldsymbol{x}_{\text{bar}}$ æ˜¯æ’å€¼)</td>
<td style="text-align:left">å¦‚æœåˆå§‹è½¨è¿¹æ˜¯ç”¨ç›´çº¿æ’å€¼ç­‰æ–¹å¼åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå®ƒä¸æ»¡è¶³ $f(\bar{\boldsymbol{x}}_k, \bar{\boldsymbol{u}}_k) = \bar{\boldsymbol{x}}_{k+1}$ï¼Œæ­¤æ—¶ $\boldsymbol{c}_k \neq 0$ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>ï¼ˆ2ï¼‰Backward Pass</strong></td>
<td style="text-align:left">(é¦–æ¬¡è¿­ä»£) ä½¿ç”¨ $\boldsymbol{c}_k \neq 0$ çš„å€¼æ¥åˆæˆ $\mathcal{Q}_k$ çš„ $\boldsymbol{q}_k, \boldsymbol{r}_k$ã€‚</td>
<td style="text-align:left"><strong>ä½¿ç”¨ $\boldsymbol{c}_k$</strong></td>
<td style="text-align:left">åªæœ‰åœ¨<strong>ç¬¬ä¸€æ¬¡</strong>è¿­ä»£ä¸­ï¼Œå½“åä¹‰è½¨è¿¹ä¸å¯è¡Œæ—¶ï¼Œæˆ‘ä»¬æ‰éœ€è¦åœ¨ $\boldsymbol{q}_k$ å’Œ $\boldsymbol{r}_k$ çš„å…¬å¼ä¸­åŒ…å« $\boldsymbol{c}_k$ é¡¹ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>ï¼ˆ3ï¼‰Forward Pass</strong></td>
<td style="text-align:left">ä½¿ç”¨ $(\boldsymbol{k}, \boldsymbol{K})$ ç­–ç•¥ï¼Œé€šè¿‡ <strong>éçº¿æ€§åŠ¨åŠ›å­¦ $f$ ç§¯åˆ†</strong> å¾—åˆ°æ–°çš„è½¨è¿¹ $(\boldsymbol{x}_{\text{new}}, \boldsymbol{u}_{\text{new}})$ã€‚</td>
<td style="text-align:left"><strong>$\boldsymbol{c}_k$ è¢«é‡ç½®ä¸º 0</strong></td>
<td style="text-align:left">æ–°è½¨è¿¹ $(\boldsymbol{x}_{\text{new}}, \boldsymbol{u}_{\text{new}})$ è¢«è®¾ä¸ºä¸‹ä¸€è½®çš„ $\bar{\boldsymbol{x}}, \bar{\boldsymbol{u}}$ã€‚å› ä¸ºå®ƒå°±æ˜¯ $f$ ç®—å‡ºæ¥çš„ï¼Œæ‰€ä»¥ $f(\bar{\boldsymbol{x}}_k, \bar{\boldsymbol{u}}_k) = \bar{\boldsymbol{x}}_{k+1}$ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>ï¼ˆ4ï¼‰åç»­ Backward Pass</strong></td>
<td style="text-align:left">(ç¬¬ 2 è½®åŠä»¥å) æ‰§è¡Œé€†å‘é€’æ¨ã€‚</td>
<td style="text-align:left"><strong>$\boldsymbol{c}_k = 0$</strong></td>
<td style="text-align:left">åç»­æ‰€æœ‰è¿­ä»£ä¸­ï¼Œåä¹‰è½¨è¿¹éƒ½æ˜¯åŠ¨æ€å¯è¡Œçš„ï¼Œ$\boldsymbol{c}_k$ é¡¹è‡ªåŠ¨æ¶ˆå¤±ã€‚</td>
</tr>
</tbody>
</table>
<h4><span id="%E7%BB%99%E5%87%BA%E4%B8%80%E6%9D%A1%E8%BD%A8%E8%BF%B9%E6%B2%A1%E6%9C%89%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%A8%A1%E5%9E%8B%E6%80%8E%E4%B9%88%E5%8A%9E">ç»™å‡ºä¸€æ¡è½¨è¿¹æ²¡æœ‰åŠ¨åŠ›å­¦æ¨¡å‹æ€ä¹ˆåŠï¼Ÿ</span></h4>
<p>å¿…é¡»æœ‰ï¼Œæ²¡æœ‰ä½ å°±è’™ä¸€ä¸ªï¼Œæ¯”å¦‚"Longitudinal Kinematic Point Model" (çºµå‘è¿åŠ¨å­¦ç‚¹æ¨¡å‹)</p>
<h2><span id="lqr%E4%B8%8Eilqr">LQRä¸iLQR</span></h2>
<table>
<thead>
<tr>
<th style="text-align:left">ç‰¹æ€§</th>
<th style="text-align:left">LQR</th>
<th style="text-align:left">LQR (ç”¨äºè·Ÿè¸ª)</th>
<th style="text-align:left">iLQR (è¿­ä»£ LQR)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ç³»ç»Ÿ</strong></td>
<td style="text-align:left">çº¿æ€§ $\boldsymbol{x}_{k+1} = \boldsymbol{A}\boldsymbol{x}_k + \boldsymbol{B}\boldsymbol{u}_k$</td>
<td style="text-align:left">çº¿æ€§ (æˆ–çº¿æ€§åŒ–)</td>
<td style="text-align:left">éçº¿æ€§ $\boldsymbol{x}_{k+1} = f(\boldsymbol{x}_k, \boldsymbol{u}_k)$</td>
</tr>
<tr>
<td style="text-align:left"><strong>ä¼˜åŒ–ç›®æ ‡</strong></td>
<td style="text-align:left">é©±åŠ¨çŠ¶æ€åˆ°<strong>åŸç‚¹</strong> $\boldsymbol{x}=0$</td>
<td style="text-align:left">æœ€å°åŒ– <strong>è¯¯å·®</strong> $\boldsymbol{e}_k$</td>
<td style="text-align:left">æœ€å°åŒ–<strong>æ€»æˆæœ¬</strong> $J(\boldsymbol{x}, \boldsymbol{u})$</td>
</tr>
<tr>
<td style="text-align:left"><strong>è¾“å‡º</strong></td>
<td style="text-align:left">çº¯åé¦ˆæ§åˆ¶ $\boldsymbol{u}^* = -\boldsymbol{K}\boldsymbol{x}$</td>
<td style="text-align:left">å‰é¦ˆ+åé¦ˆ $\boldsymbol{u}^* = \boldsymbol{u}_r - \boldsymbol{K}\boldsymbol{e}$</td>
<td style="text-align:left">ä»¿å°„æ§åˆ¶ $\boldsymbol{u}^* = \bar{\boldsymbol{u}} + \boldsymbol{k} + \boldsymbol{K}\delta \boldsymbol{x}$</td>
</tr>
<tr>
<td style="text-align:left"><strong>ç”¨é€”</strong></td>
<td style="text-align:left">é•‡å®šç³»ç»Ÿï¼Œè°ƒèŠ‚å™¨</td>
<td style="text-align:left"><strong>è·Ÿè¸ª</strong>å·²çŸ¥çš„å‚è€ƒè½¨è¿¹</td>
<td style="text-align:left"><strong>ä¼˜åŒ–ç”Ÿæˆ</strong>æœ€ä¼˜è½¨è¿¹</td>
</tr>
</tbody>
</table>
<h2><span id="ilqr-alilqr-cilqr-%E7%AE%97%E6%B3%95%E7%89%B9%E5%BE%81%E5%AF%B9%E6%AF%94">iLQR, ALiLQR, CILQR ç®—æ³•ç‰¹å¾å¯¹æ¯”</span></h2>
<p>è¿™ä¸‰è€…éƒ½æ˜¯ç”¨äºè½¨è¿¹ä¼˜åŒ–çš„é«˜æ•ˆç®—æ³•ï¼Œå®ƒä»¬çš„æ ¸å¿ƒéƒ½åŸºäº iLQRï¼ˆè¿­ä»£çº¿æ€§äºŒæ¬¡è°ƒèŠ‚å™¨ï¼‰ã€‚å®ƒä»¬æœ€å¤§çš„åŒºåˆ«åœ¨äº<strong>å¦‚ä½•å¤„ç†ä¼˜åŒ–é—®é¢˜ä¸­çš„â€œçº¦æŸâ€</strong>ã€‚</p>
<h3><span id="%E6%A0%B8%E5%BF%83%E7%89%B9%E5%BE%81%E5%AF%B9%E6%AF%94%E8%A1%A8">æ ¸å¿ƒç‰¹å¾å¯¹æ¯”è¡¨</span></h3>
<table>
<thead>
<tr>
<th style="text-align:left">ç‰¹å¾</th>
<th style="text-align:left"><code>iLQR</code> (åŸºç¡€ç‰ˆ)</th>
<th style="text-align:left"><code>ALiLQR</code> (å¢å¹¿æ‹‰æ ¼æœ—æ—¥ç‰ˆ)</th>
<th style="text-align:left"><code>CILQR</code> (å†…ç‚¹æ³•/éšœç¢å‡½æ•°ç‰ˆ)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>æ ¸å¿ƒç›®æ ‡</strong></td>
<td style="text-align:left"><strong>æ— çº¦æŸ</strong>è½¨è¿¹ä¼˜åŒ–</td>
<td style="text-align:left"><strong>æœ‰çº¦æŸ</strong>è½¨è¿¹ä¼˜åŒ–</td>
<td style="text-align:left"><strong>æœ‰çº¦æŸ</strong>è½¨è¿¹ä¼˜åŒ–</td>
</tr>
<tr>
<td style="text-align:left"><strong>çº¦æŸå¤„ç†èƒ½åŠ›</strong></td>
<td style="text-align:left">å‡ ä¹æ²¡æœ‰ï¼ˆæˆ–å¾ˆå¼±ï¼‰</td>
<td style="text-align:left">å¼ºï¼ˆç­‰å¼ &amp; ä¸ç­‰å¼çº¦æŸï¼‰</td>
<td style="text-align:left">å¼ºï¼ˆä¸»è¦ç”¨äºä¸ç­‰å¼çº¦æŸï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><strong>æ ¸å¿ƒæ•°å­¦æ–¹æ³•</strong></td>
<td style="text-align:left">è¿­ä»£LQRæ±‚è§£</td>
<td style="text-align:left"><strong>å¢å¹¿æ‹‰æ ¼æœ—æ—¥æ³• (Augmented Lagrangian)</strong></td>
<td style="text-align:left"><strong>å†…ç‚¹æ³• / éšœç¢å‡½æ•°æ³• (Interior Point / Barrier Function)</strong></td>
</tr>
<tr>
<td style="text-align:left"><strong>å¦‚ä½•å¤„ç†çº¦æŸ</strong></td>
<td style="text-align:left">-</td>
<td style="text-align:left">å°†çº¦æŸè½¬ä¸ºâ€œä»£ä»·æƒ©ç½šé¡¹â€å’Œâ€œä¹˜å­é¡¹â€</td>
<td style="text-align:left">å°†çº¦æŸè¾¹ç•Œå˜ä¸ºâ€œæ— ç©·é«˜â€çš„â€œéšœç¢å¢™â€</td>
</tr>
<tr>
<td style="text-align:left"><strong>ç®—æ³•ç»“æ„</strong></td>
<td style="text-align:left">å•å¾ªç¯ï¼ˆå‰å‘-åå‘è¿­ä»£ï¼‰</td>
<td style="text-align:left"><strong>åŒå±‚å¾ªç¯</strong> (å¤–å¾ªç¯æ›´æ–°çº¦æŸï¼Œå†…å¾ªç¯è·‘iLQR)</td>
<td style="text-align:left">å•å¾ªç¯ï¼ˆä½†åœ¨ä»£ä»·å‡½æ•°ä¸­åŠ å…¥äº†éšœç¢é¡¹ï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><strong>å¯¹åˆå§‹è½¨è¿¹è¦æ±‚</strong></td>
<td style="text-align:left">ä½</td>
<td style="text-align:left"><strong>ä½</strong>ï¼ˆå¯ä»¥ä»<em>ä¸å¯è¡Œ</em>çš„è½¨è¿¹å¼€å§‹ï¼‰</td>
<td style="text-align:left"><strong>é«˜</strong>ï¼ˆ<strong>å¿…é¡»</strong>ä»<em>ä¸¥æ ¼å¯è¡Œ</em>çš„è½¨è¿¹å¼€å§‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><strong>è¿­ä»£è¿‡ç¨‹ç‰¹ç‚¹</strong></td>
<td style="text-align:left">è½¨è¿¹é€æ­¥é€¼è¿‘æœ€ä¼˜</td>
<td style="text-align:left">è½¨è¿¹å¯<em>ç©¿è¿‡</em>çº¦æŸè¾¹ç•Œï¼Œå†è¢«â€œæ‹‰â€å›</td>
<td style="text-align:left">è½¨è¿¹<strong>å§‹ç»ˆä¿æŒ</strong>åœ¨çº¦æŸè¾¹ç•Œå†…éƒ¨</td>
</tr>
</tbody>
</table>
<hr>
<h3><span id="1-ilqr-iterative-linear-quadratic-regulator">1. <code>iLQR</code> (Iterative Linear Quadratic Regulator)</span></h3>
<ul>
<li><strong>å…¨ç§°</strong>ï¼šè¿­ä»£çº¿æ€§äºŒæ¬¡è°ƒèŠ‚å™¨</li>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š
<ol>
<li>åœ¨ä¸€ä¸ªåä¹‰è½¨è¿¹ï¼ˆNominal Trajectoryï¼‰å‘¨å›´ï¼Œå°†<strong>éçº¿æ€§</strong>çš„ç³»ç»ŸåŠ¨åŠ›å­¦ <em>çº¿æ€§åŒ–</em>ã€‚</li>
<li>å°†<strong>éäºŒæ¬¡</strong>çš„ä»£ä»·å‡½æ•° <em>äºŒæ¬¡åŒ–</em>ã€‚</li>
<li>è¿™æ ·é—®é¢˜å°±å˜æˆäº†ä¸€ä¸ªå±€éƒ¨çš„ LQR é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰é«˜æ•ˆæ±‚è§£ï¼Œå¾—åˆ°ä¸€ä¸ªæ›´ä¼˜çš„æ§åˆ¶ç­–ç•¥ã€‚</li>
<li>ä¸æ–­é‡å¤è¿™ä¸ªâ€œçº¿æ€§åŒ–-äºŒæ¬¡åŒ–-æ±‚è§£â€çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ”¶æ•›ã€‚</li>
</ol>
</li>
<li><strong>çº¦æŸå¤„ç†</strong>ï¼š
<ul>
<li>æ ‡å‡† iLQR <strong>ä¸ç›´æ¥æ”¯æŒ</strong>ç¡¬çº¦æŸï¼ˆå¦‚å…³èŠ‚é™ä½ã€é¿éšœï¼‰ã€‚</li>
<li>åœ¨å®è·µä¸­ï¼Œäººä»¬æœ‰æ—¶ä¼šç”¨ä¸€äº›æŠ€å·§ï¼ˆHacksï¼‰æ¥æ¨¡æ‹Ÿçº¦æŸï¼Œæ¯”å¦‚ï¼š
<ul>
<li>å°†çº¦æŸä½œä¸º<strong>è½¯çº¦æŸ</strong>ï¼ˆSoft Constraintï¼‰æ·»åŠ åˆ°ä»£ä»·å‡½æ•°ä¸­ï¼ˆä¾‹å¦‚ï¼š<code>cost += w * (q - q_limit)^2</code>ï¼‰ã€‚</li>
<li>åœ¨æ§åˆ¶è¾“å…¥ä¸Šè¿›è¡Œç®€å•çš„â€œè£å‰ªâ€ï¼ˆClippingï¼‰ã€‚</li>
</ul>
</li>
<li>è¿™äº›æ–¹æ³•å¹¶ä¸ä¸¥è°¨ï¼Œä¸”æ•ˆæœé€šå¸¸ä¸å¥½ã€‚</li>
</ul>
</li>
<li><strong>æ¯”å–»</strong>ï¼š<strong>çŸ­è·‘è¿åŠ¨å‘˜</strong>ã€‚ä»–åªç®¡åœ¨æ²¡æœ‰éšœç¢çš„ç›´è·‘é“ä¸Šç”¨æœ€å¿«çš„é€Ÿåº¦å†²åˆºï¼ˆæœ€å°åŒ–ä»£ä»·ï¼‰ã€‚</li>
</ul>
<h3><span id="2-alilqr-augmented-lagrangian-ilqr">2. <code>ALiLQR</code> (Augmented Lagrangian iLQR)</span></h3>
<ul>
<li><strong>å…¨ç§°</strong>ï¼šå¢å¹¿æ‹‰æ ¼æœ—æ—¥ iLQR</li>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š
<ul>
<li>é‡‡ç”¨<strong>å¢å¹¿æ‹‰æ ¼æœ—æ—¥æ–¹æ³•</strong>ï¼Œå°†ä¸€ä¸ª<strong>æœ‰çº¦æŸ</strong>é—®é¢˜è½¬åŒ–ä¸ºä¸€ç³»åˆ—<strong>æ— çº¦æŸ</strong>é—®é¢˜æ¥æ±‚è§£ã€‚</li>
<li>å®ƒåœ¨åŸä»£ä»·å‡½æ•° <code>J</code> çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†â€œæ‹‰æ ¼æœ—æ—¥ä¹˜å­é¡¹ <code>Î»</code>â€å’Œâ€œäºŒæ¬¡æƒ©ç½šé¡¹ <code>Î¼</code>â€ã€‚</li>
<li>æ–°çš„ä»£ä»·å˜ä¸ºï¼š<code>J_aug = J + Î» * c(x) + Î¼ * c(x)^2</code>ï¼ˆç®€åŒ–ç¤ºæ„ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>ç®—æ³•ç»“æ„ï¼ˆåŒå¾ªç¯ï¼‰</strong>ï¼š
<ol>
<li><strong>å†…å¾ªç¯</strong>ï¼šå›ºå®šå½“å‰çš„ <code>Î»</code> å’Œ <code>Î¼</code>ï¼Œè°ƒç”¨ <strong>iLQR</strong> æ¥æœ€å°åŒ–è¿™ä¸ª <code>J_aug</code>ï¼ˆè¿™æ­¥æ˜¯æ— çº¦æŸçš„ï¼‰ã€‚</li>
<li><strong>å¤–å¾ªç¯</strong>ï¼šåœ¨ iLQR æ”¶æ•›åï¼Œæ£€æŸ¥å½“å‰è½¨è¿¹å¯¹çº¦æŸ <code>c(x)</code> çš„è¿åç¨‹åº¦ã€‚
<ul>
<li>å¦‚æœè¿åä¸¥é‡ï¼Œå°±<strong>å¢å¤§</strong>æƒ©ç½šç³»æ•° <code>Î¼</code>ï¼ˆåŠ å¤§ç½šæ¬¾åŠ›åº¦ï¼‰ã€‚</li>
<li>æ ¹æ®è¿åæƒ…å†µï¼Œ<strong>æ›´æ–°</strong>æ‹‰æ ¼æœ—æ—¥ä¹˜å­ <code>Î»</code>ï¼ˆè°ƒæ•´ç½šæ¬¾åŸºå‡†ï¼‰ã€‚</li>
</ul>
</li>
<li>é‡å¤1å’Œ2ï¼Œç›´åˆ°çº¦æŸè¢«æ»¡è¶³ä¸”ä»£ä»·æœ€ä¼˜ã€‚</li>
</ol>
</li>
<li><strong>æ¯”å–»</strong>ï¼š<strong>ç½šæ¬¾åˆ¶éšœç¢èµ›</strong>ã€‚è¿åŠ¨å‘˜å¯ä»¥â€œæ’åˆ°â€æ æ¶ï¼ˆæš‚æ—¶è¿åçº¦æŸï¼‰ï¼Œä½†æ¯æ¬¡éƒ½ä¼šè¢«â€œç½šæ¬¾â€ï¼ˆæƒ©ç½šé¡¹ï¼‰ã€‚ä»–ä¼šé€šè¿‡è°ƒæ•´ç­–ç•¥ï¼ˆæ›´æ–° <code>Î»</code> å’Œ <code>Î¼</code>ï¼‰ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€æ¡æ—¢è·‘å¾—å¿«ã€åˆä¸å†æ’æ ï¼ˆæ»¡è¶³çº¦æŸï¼‰çš„è·¯çº¿ã€‚</li>
</ul>
<h3><span id="3-cilqr-constrained-ilqr">3. <code>CILQR</code> (Constrained iLQR)</span></h3>
<ul>
<li><strong>å…¨ç§°</strong>ï¼šçº¦æŸ iLQR (é€šå¸¸ç‰¹æŒ‡åŸºäºå†…ç‚¹æ³•çš„å®ç°)</li>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š
<ul>
<li>é‡‡ç”¨**å†…ç‚¹æ³•ï¼ˆæˆ–ç§°éšœç¢å‡½æ•°æ³•ï¼‰**æ¥å¤„ç†ä¸ç­‰å¼çº¦æŸï¼ˆä¾‹å¦‚ <code>g(x) &lt;= 0</code>ï¼‰ã€‚</li>
<li>å®ƒåœ¨ä»£ä»·å‡½æ•° <code>J</code> ä¸­åŠ å…¥ä¸€ä¸ª<strong>éšœç¢é¡¹ (Barrier Term)</strong>ï¼Œæœ€å¸¸è§çš„æ˜¯å¯¹æ•°éšœç¢å‡½æ•°ï¼š<code>J_barrier = J - Î¼ * log(-g(x))</code>ã€‚</li>
</ul>
</li>
<li><strong>å·¥ä½œæœºåˆ¶</strong>ï¼š
<ul>
<li>å½“è½¨è¿¹ <code>x</code> <strong>è¿œç¦»</strong>çº¦æŸè¾¹ç•Œæ—¶ï¼ˆ<code>g(x)</code> æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„è´Ÿæ•°ï¼‰ï¼Œ<code>log(-g(x))</code> å˜åŒ–å¾ˆå°ï¼Œå¯¹ä¼˜åŒ–å½±å“ä¸å¤§ã€‚</li>
<li>å½“è½¨è¿¹ <code>x</code> <strong>æ¥è¿‘</strong>çº¦æŸè¾¹ç•Œæ—¶ï¼ˆ<code>g(x)</code> è¶‹è¿‘äº0ï¼‰ï¼Œ<code>log(-g(x))</code> ä¼šè¿…é€Ÿè¶‹å‘<strong>è´Ÿæ— ç©·</strong>ï¼Œå¯¼è‡´ <code>-Î¼ * log(-g(x))</code> å˜æˆä¸€ä¸ª<strong>æ— ç©·å¤§çš„ä»£ä»·</strong>ã€‚</li>
<li>è¿™ä¸ªâ€œæ— ç©·å¤§â€çš„ä»£ä»·å¢™ä¼šé˜»æ­¢ iLQR ä¼˜åŒ–å™¨åœ¨æ±‚è§£æ—¶è¶Šè¿‡çº¦æŸè¾¹ç•Œã€‚</li>
</ul>
</li>
<li><strong>å…³é”®è¦æ±‚</strong>ï¼š
<ul>
<li>è¿™ç§æ–¹æ³•<strong>è¦æ±‚åˆå§‹è½¨è¿¹å¿…é¡»ä¸¥æ ¼å¯è¡Œ</strong>ï¼ˆå³ <code>g(x) &lt; 0</code>ï¼‰ã€‚å¦‚æœåˆå§‹è½¨è¿¹å°±åœ¨è¾¹ç•Œå¤–ï¼Œ<code>log</code> å‡½æ•°çš„è¾“å…¥ä¸ºæ­£æ•°ï¼Œç®—æ³•ä¼šç›´æ¥å´©æºƒã€‚</li>
</ul>
</li>
</ul>
<h1><span id="alilqr%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8">ALiLQRåœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨</span></h1>
<h2><span id="%E8%BD%A6%E8%BE%86%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%A8%A1%E5%9E%8B">è½¦è¾†åŠ¨åŠ›å­¦æ¨¡å‹</span></h2>
<h3><span id="1%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%98%E9%87%8F">1.å®šä¹‰çŠ¶æ€å˜é‡å’Œæ§åˆ¶å˜é‡</span></h3>
<p>$$x = \begin{bmatrix} x_0 \\ x_1 \\ x_2 \\ x_3 \\ x_4 \\ x_5 \end{bmatrix} = \begin{bmatrix} \text{pos\\_x} &amp; (\text{Xåæ ‡}) \\ \text{pos\\_y} &amp; (\text{Yåæ ‡}) \\ \theta &amp; (\text{èˆªå‘è§’ Yaw}) \\ v &amp; (\text{çºµå‘é€Ÿåº¦}) \\ a &amp; (\text{çºµå‘åŠ é€Ÿåº¦}) \\ \omega &amp; (\text{è§’é€Ÿåº¦ YawRate}) \end{bmatrix}$$</p>
<p>$$u = \begin{bmatrix} u_0 \\ u_1 \end{bmatrix} = \begin{bmatrix} \text{Jerk} &amp; (\text{åŠ åŠ é€Ÿåº¦/å˜åŠ é€Ÿç‡}) \\ \dot{\omega} &amp; (\text{è§’åŠ é€Ÿåº¦}) \end{bmatrix}$$</p>
<h3><span id="2%E5%AE%9E%E7%8E%B0%E8%BF%90%E5%8A%A8%E6%96%B9%E7%A8%8B%E4%B8%8E%E7%A7%AF%E5%88%86%E7%A6%BB%E6%95%A3">2.å®ç°è¿åŠ¨æ–¹ç¨‹ä¸ç§¯åˆ†ç¦»æ•£</span></h3>
<a href="/2025/11/18/%E5%B7%A5%E4%BD%9C/IDM%E6%A8%A1%E5%9E%8B/" title="è¿åŠ¨å­¦æ¨¡å‹çš„å‰å‘é€’æ¨-IDMä¸è‡ªè¡Œè½¦">è¿åŠ¨å­¦æ¨¡å‹çš„å‰å‘é€’æ¨-IDMä¸è‡ªè¡Œè½¦</a>
<p>ä½¿ç”¨é¾™æ ¼åº“å¡”ç§¯åˆ†</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">LKPointModel::forward_calculation</span><span class="hljs-params">(<span class="hljs-type">const</span> State&amp; state, <span class="hljs-type">const</span> Control&amp; ctrl,</span></span><br><span class="hljs-params"><span class="hljs-function">                                       State&amp; state_output, <span class="hljs-type">double</span> step)</span> <span class="hljs-type">const</span> </span><br></code></pre></td></tr></tbody></table></figure>
<p>æˆ‘ä»¬éœ€è¦å¾—åˆ°
$$A_t = \frac{\partial f_{RK4}(x_t, u_t)}{\partial x} \quad (6 \times 6 \text{ çŸ©é˜µ})$$
$$B_t = \frac{\partial f_{RK4}(x_t, u_t)}{\partial u} \quad (6 \times 2 \text{ çŸ©é˜µ})$$</p>
<p>ä¸€ä¸ªä½¿ç”¨pythonè‡ªåŠ¨æ¨å¯¼å¹¶å¾—åˆ°C++ä»£ç çš„æ–¹å¼</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sympy <span class="hljs-keyword">as</span> sp<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_jacobian_code</span>():<br>    <span class="hljs-comment"># 1. å®šä¹‰ç¬¦å·å˜é‡</span><br>    <span class="hljs-comment"># çŠ¶æ€å˜é‡ x (6ç»´)</span><br>    x, y, theta, v, a, omega = sp.symbols(<span class="hljs-string">'x y theta v a omega'</span>)<br>    state = sp.Matrix([x, y, theta, v, a, omega])<br>    <br>    <span class="hljs-comment"># æ§åˆ¶å˜é‡ u (2ç»´)</span><br>    jerk, d_omega = sp.symbols(<span class="hljs-string">'jerk d_omega'</span>)<br>    control = sp.Matrix([jerk, d_omega])<br>    <br>    <span class="hljs-comment"># æ—¶é—´æ­¥é•¿</span><br>    h = sp.symbols(<span class="hljs-string">'h'</span>)<br><br>    <span class="hljs-comment"># 2. å®šä¹‰è¿ç»­æ—¶é—´åŠ¨åŠ›å­¦æ–¹ç¨‹ (ODE) f(x, u)</span><br>    <span class="hljs-comment"># è¿™å¯¹åº”ä»£ç ä¸­çš„ continue_gradiant</span><br>    dx = v * sp.cos(theta)<br>    dy = v * sp.sin(theta)<br>    dtheta = omega<br>    dv = a<br>    da = jerk<br>    domega = d_omega<br>    <br>    f_continuous = sp.Matrix([dx, dy, dtheta, dv, da, domega])<br><br>    <span class="hljs-comment"># 3. å®šä¹‰ RK4 ç§¯åˆ†æ­¥éª¤ (ç¬¦å·åŒ–)</span><br>    <span class="hljs-comment"># k1</span><br>    k1 = f_continuous<br>    <br>    <span class="hljs-comment"># k2 (æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æŠŠ f_continuous é‡Œçš„ state æ›¿æ¢ä¸º state + 0.5*h*k1)</span><br>    state_k2 = state + <span class="hljs-number">0.5</span> * h * k1<br>    <span class="hljs-comment"># æ›¿æ¢è§„åˆ™ï¼šå°†åŸå§‹å˜é‡æ›¿æ¢ä¸ºä¸­é—´å˜é‡</span><br>    subs_k2 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(state, state_k2)) <br>    k2 = f_continuous.subs(subs_k2)<br>    <br>    <span class="hljs-comment"># k3</span><br>    state_k3 = state + <span class="hljs-number">0.5</span> * h * k2<br>    subs_k3 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(state, state_k3))<br>    k3 = f_continuous.subs(subs_k3)<br>    <br>    <span class="hljs-comment"># k4</span><br>    state_k4 = state + h * k3<br>    subs_k4 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(state, state_k4))<br>    k4 = f_continuous.subs(subs_k4)<br>    <br>    <span class="hljs-comment"># 4. å¾—åˆ°ç¦»æ•£æ—¶é—´æ¨¡å‹ x_{k+1}</span><br>    state_next = state + (h / <span class="hljs-number">6.0</span>) * (k1 + <span class="hljs-number">2</span>*k2 + <span class="hljs-number">2</span>*k3 + k4)<br><br>    <span class="hljs-comment"># 5. æ±‚å¯¼ï¼è®¡ç®— Jacobian A å’Œ B</span><br>    <span class="hljs-comment"># A = d(state_next) / d(state)</span><br>    A = state_next.jacobian(state)<br>    <br>    <span class="hljs-comment"># B = d(state_next) / d(control)</span><br>    B = state_next.jacobian(control)<br><br>    <span class="hljs-comment"># 6. ä»£ç ä¼˜åŒ–ï¼šå…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤ (CSE)</span><br>    <span class="hljs-comment"># è¿™ä¸€æ­¥æ˜¯"æè‡´é€Ÿåº¦"çš„å…³é”®ã€‚å®ƒä¼šæŠŠé‡å¤è®¡ç®—çš„ sin, cos æå–å‡ºæ¥</span><br>    <span class="hljs-comment"># æ¯”å¦‚æˆªå›¾é‡Œçš„ double theta_K1 = ...; double cos_theta_K1 = ...;</span><br>    sub_exprs, (A_simple, B_simple) = sp.cse([A, B])<br><br>    <span class="hljs-comment"># 7. æ‰“å° C++ ä»£ç </span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"// --- è‡ªåŠ¨ç”Ÿæˆçš„ C++ ä»£ç å¼€å§‹ ---"</span>)<br>    <br>    <span class="hljs-comment"># æ‰“å°ä¸­é—´å˜é‡</span><br>    <span class="hljs-keyword">for</span> var, expr <span class="hljs-keyword">in</span> sub_exprs:<br>        <span class="hljs-comment"># è½¬æ¢ sympy è¡¨è¾¾å¼ä¸º C++ æ ¼å¼ (ç®€å•æ›¿æ¢)</span><br>        c_expr = <span class="hljs-built_in">str</span>(expr).replace(<span class="hljs-string">"sin"</span>, <span class="hljs-string">"std::sin"</span>).replace(<span class="hljs-string">"cos"</span>, <span class="hljs-string">"std::cos"</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"double <span class="hljs-subst">{var}</span> = <span class="hljs-subst">{c_expr}</span>;"</span>)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n// å¡«å…… A çŸ©é˜µ"</span>)<br>    rows, cols = A_simple.shape<br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rows):<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cols):<br>            val = A_simple[r, c]<br>            <span class="hljs-keyword">if</span> val != <span class="hljs-number">0</span>: <span class="hljs-comment"># å¿½ç•¥0ä»¥èŠ‚çœèµ‹å€¼æ—¶é—´</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"A_output(<span class="hljs-subst">{r}</span>, <span class="hljs-subst">{c}</span>) = <span class="hljs-subst">{val}</span>;"</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n// å¡«å…… B çŸ©é˜µ"</span>)<br>    rows, cols = B_simple.shape<br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rows):<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cols):<br>            val = B_simple[r, c]<br>            <span class="hljs-keyword">if</span> val != <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"B_output(<span class="hljs-subst">{r}</span>, <span class="hljs-subst">{c}</span>) = <span class="hljs-subst">{val}</span>;"</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    generate_jacobian_code()<br></code></pre></td></tr></tbody></table></figure>
<h2><span id="%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E6%B1%82%E8%A7%A3%E6%9C%80%E4%BC%98%E6%8E%A7%E5%88%B6">åå‘ä¼ æ’­ï¼Œæ±‚è§£æœ€ä¼˜æ§åˆ¶</span></h2>
<p>æˆ‘ä»¬ä¼˜åŒ–çš„ç›®æ ‡å‡½æ•° $J$ æ˜¯åŒæ—¶å–å†³äº çŠ¶æ€ $x$ å’Œ æ§åˆ¶ $u$ çš„ã€‚</p>
<p>$$J(x, u) = \text{StateCost}(x) + \text{ControlCost}(u)$$
ä¸ºäº†åœ¨çŸ©é˜µè¿ç®—ä¸­æ–¹ä¾¿ï¼ŒiLQR è¿™é‡Œæš‚æ—¶å°†çŠ¶æ€å’Œæ§åˆ¶æ‹¼æˆä¸€ä¸ªå¢å¹¿å‘é‡ (Augmented Vector)ï¼š</p>
<p>$$\mathbf{z} = \begin{bmatrix} x \\ u \end{bmatrix} \quad (\text{ç»´åº¦ } 6 + 2 = 8)$$
åé¢åœ¨è®¡ç®—æ¢¯åº¦ç­‰å†…å®¹æ—¶ä¼šæ‹†å¼€çš„ã€‚
å¯¹æ¯ä¸€ä¸ªæ—¶é—´æ­¥/å‚è€ƒç‚¹iï¼ŒActionCostFunctionè¾“å‡ºï¼š</p>
<ol>
<li>hessians_[i] (çŸ©é˜µ H)ï¼šä¸€ä¸ª $8 \times 8$ çš„çŸ©é˜µï¼ˆ6ç»´çŠ¶æ€ + 2ç»´æ§åˆ¶ï¼‰ã€‚ä»£è¡¨äºŒæ¬¡é¡¹ç³»æ•°ã€‚</li>
</ol>
<p>$$\mathbf{H} = \begin{bmatrix} \color{blue}{w_{x}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; \color{blue}{w_{y}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; \color{gray}{0} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; \color{gray}{0} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \color{blue}{w_{a}} &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \color{gray}{0} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \color{red}{w_{j}} &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \color{red}{w_{\dot{\omega}}} \end{bmatrix}$$</p>
<ol>
<li>gradiants_[i] (å‘é‡ g)ï¼šä¸€ä¸ª $8 \times 1$ çš„å‘é‡ã€‚ä»£è¡¨ä¸€æ¬¡é¡¹ç³»æ•°ã€‚</li>
</ol>
<p>$$\mathbf{g} = \begin{bmatrix} -2 \cdot w_{x} \cdot \text{ref\\_x}[i] \\ -2 \cdot w_{y} \cdot \text{ref\\_y}[i] \\ \color{gray}{0} \\ \color{gray}{0} \\ -2 \cdot w_{a} \cdot \text{ref\\_a}[i] \\ \color{gray}{0} \\ \color{green}{0} \\ \color{green}{0} \end{bmatrix}$$</p>
<p><strong>å¦‚ä½•è·å–è¿™ä¸¤ä¸ªé‡ï¼Ÿï¼š</strong> æˆ‘ä»¬è¦è¿½è¸ªä¸€ä¸ªå‚è€ƒç‚¹ $x_{ref}$ã€‚ä»£ä»·å‡½æ•°å®šä¹‰ä¸ºè¯¯å·®çš„å¹³æ–¹ï¼š</p>
<p>$$J(x) = w \cdot (x - x_{ref})^2 = \underbrace{w}_{H} \cdot x^2 + \underbrace{(-2w \cdot x_{ref})}_{g} \cdot x + \text{const}$$</p>
<p>$$l_x = \frac{\partial J}{\partial x} = 2 \cdot w \cdot (x - x_{ref}) = 2wx - 2wx_{ref}$$</p>
<p>$$l_{xx} = \frac{\partial^2 J}{\partial x^2} = 2w$$</p>
<p>é‚£ä¹ˆä»£å…¥å¯ä»¥æœ‰
$$l_x = g + 2Hx$$</p>
<p>$$l_{xx} = 2H$$
æˆ‘ä»¬å…ˆé¢„è®¡ç®—å‡ºgå’ŒHï¼Œå¾…è¿›è¡Œåå‘ä¼ æ’­æ—¶å€™ï¼Œä»£å…¥xï¼Œå¾—åˆ°çœŸæ­£çš„æ¢¯åº¦ã€‚
è¿™é‡Œå¯ä»¥æŠŠçŸ©é˜µçš„çŠ¶æ€å˜é‡éƒ¨åˆ†å’Œæ§åˆ¶å˜é‡éƒ¨åˆ†æ‹†å¼€ï¼Œå³å¯å¾—åˆ°</p>
<p>$l_x, l_u$ (æ¢¯åº¦)</p>
<p>$l_{xx}, l_{uu}, l_{xu}$ (Hessian)</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°åœ¨æŸä¸ªç‚¹å¤„çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ¥è‡ªè½¦è¾†åŠ¨åŠ›å­¦ï¼‰
$A_k = \frac{\partial f}{\partial x}$</p>
<p>$B_k = \frac{\partial f}{\partial u}$</p>
<p>ç„¶åå°±æ˜¯ç”±æœªæ¥æ—¶åˆ»ä¼ é€’æ¥çš„æœªæ¥æ¢¯åº¦ã€hessian
$V_xâ€™$ (æœªæ¥çš„æ¢¯åº¦ï¼Œä»£ç  Vdx)</p>
<p>$V_{xx}'$ (æœªæ¥çš„ Hessianï¼Œä»£ç  Vddx)</p>
<p>æ¥ä¸‹æ¥åªéœ€è¦ä¾æ®å…¬å¼ç»„è£…å¯¹åº”çš„q,r,Q,R,Må³å¯</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Px åˆå§‹å€¼å·²ç»æ˜¯ lx</span><br>Px.<span class="hljs-built_in">noalias</span>() += cur_A.<span class="hljs-built_in">transpose</span>() * Vdx;<br><span class="hljs-comment">// Pu åˆå§‹å€¼å·²ç»æ˜¯ lu</span><br>Pu.<span class="hljs-built_in">noalias</span>() += cur_B.<span class="hljs-built_in">transpose</span>() * Vdx;<br><span class="hljs-comment">// Pxx åˆå§‹å€¼å·²ç»æ˜¯ lxx</span><br>Pxx.<span class="hljs-built_in">noalias</span>() += cur_A.<span class="hljs-built_in">transpose</span>() * Vddx * cur_A;<br><span class="hljs-comment">// Puu åˆå§‹å€¼å·²ç»æ˜¯ luu</span><br>Puu.<span class="hljs-built_in">noalias</span>() += cur_B.<span class="hljs-built_in">transpose</span>() * Vddx * cur_B;<br><span class="hljs-comment">// Pxu åˆå§‹å€¼é€šå¸¸æ˜¯ 0 (é™¤é ActionCost æœ‰äº¤å‰é¡¹)</span><br>Pxu.<span class="hljs-built_in">noalias</span>() += cur_A.<span class="hljs-built_in">transpose</span>() * Vddx * cur_B;<br></code></pre></td></tr></tbody></table></figure>
<p>ç„¶åæ±‚è§£æœ€ä¼˜æ§åˆ¶é‡</p>
<p>$$\delta u = \underbrace{-\mathbf{R}^{-1} \mathbf{r}}_{\text{å‰é¦ˆ } k} + \underbrace{-\mathbf{R}^{-1} \mathbf{M}^T}_{\text{åé¦ˆ } K} \delta x$$</p>
<p>æˆ‘ä»¬è¦è®¡ç®—ä¸¤ä¸ªé‡ï¼š
<strong>å‰é¦ˆå‘é‡</strong> $k$ (Feedforward) $\rightarrow$ ä»£ç ä¸­çš„ grad_temp</p>
<p><strong>åé¦ˆçŸ©é˜µ</strong> $K$ (Feedback) $\rightarrow$ ä»£ç ä¸­çš„ gain_temp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. ä½¿ç”¨ Cholesky åˆ†è§£æ£€æŸ¥æ­£å®šæ€§å¹¶å‡†å¤‡æ±‚é€†</span><br><span class="hljs-comment">// Puu_regular å°±æ˜¯ R çŸ©é˜µ (2x2)</span><br><span class="hljs-function">Eigen::LLT&lt;Eigen::MatrixXd&gt; <span class="hljs-title">lltOfA</span><span class="hljs-params">(Puu_regular)</span></span>; <br><br><span class="hljs-keyword">if</span> (lltOfA.<span class="hljs-built_in">info</span>() == Eigen::NumericalIssue) {<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// å¦‚æœä¸æ˜¯æ­£å®šçš„ï¼ˆæ¯”å¦‚æ˜¯ä¸ªé©¬éé¢ï¼‰ï¼Œå°±æŠ¥é”™ï¼Œè®©å¤–å±‚å¢åŠ æ­£åˆ™åŒ– mu</span><br>}<br><br><span class="hljs-comment">// 2. æ±‚é€†</span><br>Puu_inv = Puu_regular.<span class="hljs-built_in">inverse</span>();<br><br><span class="hljs-comment">// Puu_inv æ˜¯ (2x2), Pu æ˜¯ (2x1)</span><br><span class="hljs-comment">// ç»“æœ grad_temp æ˜¯ (2x1)</span><br>grad_temp.<span class="hljs-built_in">noalias</span>() = -Puu_inv * Pu;<br><br><span class="hljs-comment">// Pxu_regular å®é™…ä¸Šå­˜å‚¨çš„æ˜¯ Q_xu (6x2)</span><br><span class="hljs-comment">// Puu_inv æ˜¯ (2x2)</span><br>gain_temp.<span class="hljs-built_in">noalias</span>() = -Pxu_regular * Puu_inv;<br></code></pre></td></tr></tbody></table></figure>
<p>ç»è¿‡åå‘ä¼ æ’­ï¼Œä»æœ«ç«¯åˆ°èµ·ç‚¹éå†å‚è€ƒè·¯å¾„ä¸Šçš„æ¯ä¸€ä¸ªç‚¹ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ¯ä¸€ä¸ªç‚¹çš„å‰é¦ˆå’Œåé¦ˆç³»æ•°ã€‚</p>
<h2><span id="%E5%89%8D%E5%90%91%E9%80%92%E6%8E%A8forward-pass">å‰å‘é€’æ¨Forward Pass</span></h2>
<p>ï¼ˆåˆå§‹åŒ–å‡è®¾jerkå’Œdyawrateéƒ½ä¸º0ï¼‰
å‡è®¾æˆ‘ä»¬æ­£åœ¨è¿›è¡Œç¬¬ step = i çš„è®¡ç®—ï¼š
<strong>è¾“å…¥ï¼š</strong>
ä¸Šä¸€æ­¥ï¼ˆ$i-1$ï¼‰ç®—å‡ºæ¥çš„å½“å‰æœ€æ–°çŠ¶æ€ state ($x_{new, i}$)</p>
<p>ä¸Šä¸€è½®è¿­ä»£ç•™ä¸‹çš„æ—§çŠ¶æ€ ($x_{old, i}$) å’Œ æ—§æ§åˆ¶ ($u_{old, i}$)ã€‚</p>
<p>è¿™ä¸€æ­¥çš„ç­–ç•¥ $K_i$ å’Œ $k_i$ã€‚</p>
<p><strong>è®¡ç®—æœ€ä¼˜æ§åˆ¶ï¼š</strong>
$\delta x = x_{new, i} - x_{old, i}$</p>
<p>$$u_{new, i} = u_{old, i} + \alpha \cdot k_i + K_i \cdot \delta x$$</p>
<p><strong>æ›´æ–°çŠ¶æ€ï¼š</strong>
$x_{new, i+1} = f(x_{new, i}, u_{new, i})$</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> step = <span class="hljs-number">0</span>; step &lt; horizon_; step++) {<br>    <br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// 1. ä¿å­˜å½“å‰çŠ¶æ€ (Save Current State)</span><br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// æŠŠä¸Šä¸€è½®è¿­ä»£æ¨æ¼”å‡ºçš„ state å­˜å…¥æ–°è½¨è¿¹åˆ—è¡¨</span><br>    (*new_states_ptr_)[step] = state;<br><br><br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// 2. è®¡ç®—çŠ¶æ€åå·® (Calculate State Error)</span><br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// delta_x = x_new - x_old</span><br>    <span class="hljs-comment">// optimal_states_ptr_ å­˜å‚¨çš„æ˜¯ä¸Šä¸€è½®çš„æ—§è½¨è¿¹ (x_old)</span><br>    State state_error = state - (*optimal_states_ptr_)[step];<br><br><br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// 3. è®¡ç®—æœ€ä¼˜æ§åˆ¶ u_new (Calculate Optimal Control)</span><br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// å…¬å¼: u_new = u_old + K * delta_x + alpha * k</span><br>    <span class="hljs-comment">// </span><br>    <span class="hljs-comment">// (*optimal_inputs_ptr_)[step]  -&gt; u_old (æ—§æ§åˆ¶)</span><br>    <span class="hljs-comment">// gain_mats_[step].transpose()  -&gt; K (åé¦ˆçŸ©é˜µï¼Œæ³¨æ„è½¬ç½®)</span><br>    <span class="hljs-comment">// grad_vecs_[step]              -&gt; k (å‰é¦ˆå‘é‡)</span><br>    <br>    Control input = (*optimal_inputs_ptr_)[step] + <br>                    gain_mats_[step].<span class="hljs-built_in">transpose</span>() * state_error + <br>                    alpha * grad_vecs_[step];<br><br>    <span class="hljs-comment">// ä¿å­˜æ–°è®¡ç®—å‡ºçš„æ§åˆ¶é‡</span><br>    (*new_inputs_ptr_)[step] = (input);<br><br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// 4. æ›´æ–°çŠ¶æ€ / åŠ¨åŠ›å­¦æ¨æ¼” (Dynamics Update)</span><br>    <span class="hljs-comment">// -------------------------------------------------------------</span><br>    <span class="hljs-comment">// å…¬å¼: x_new_next = f(x_new_curr, u_new_curr)</span><br>    <span class="hljs-comment">// </span><br>    <span class="hljs-comment">// è¾“å…¥: å½“å‰çŠ¶æ€ state, å½“å‰æ§åˆ¶ input</span><br>    <span class="hljs-comment">// è¾“å‡º: ä¸‹ä¸€æ—¶åˆ»çŠ¶æ€ (ç›´æ¥æ›´æ–°åˆ° state å˜é‡ä¸­)</span><br>    model_ptr_-&gt;forward_calculation(state, input, state);<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2><span id="%E8%BD%A8%E8%BF%B9cost%E8%AE%A1%E7%AE%97">è½¨è¿¹costè®¡ç®—</span></h2>
<p>éå†æ•´æ¡æ–°è½¨è¿¹ï¼ŒæŠŠ ActionCost, ObstacleCost ç­‰æ‰€æœ‰ä»£ä»·åŠ èµ·æ¥ã€‚</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">new_cost = <span class="hljs-built_in">get_traj_value</span>(new_states_ptr_, new_inputs_ptr_);<br></code></pre></td></tr></tbody></table></figure>
<p><strong>éªŒæ”¶ï¼šçº¿æœç´¢ (Line Search Check)</strong>
è¿™æ˜¯ iLQR ç¨³å®šæ€§çš„å…³é”®ã€‚æˆ‘ä»¬æ¯”è¾ƒ new_cost å’Œ old_costã€‚</p>
<p><strong>æƒ…å†µ Aï¼š</strong> æ–°è½¨è¿¹æ›´å¥½äº† ($J_{new} &lt; J_{old}$)
åˆ¤å®šï¼š è¿­ä»£æˆåŠŸï¼
åŠ¨ä½œï¼šæŠŠ new_states æ‰¶æ­£ï¼Œè¦†ç›–æ‰ optimal_statesï¼ˆæ—§è½¨è¿¹ï¼‰ã€‚
æŠŠ new_inputs æ‰¶æ­£ï¼Œè¦†ç›–æ‰ optimal_inputsã€‚
æ›´æ–°å½“å‰çš„ optimal_cost = new_costã€‚</p>
<p><strong>æƒ…å†µ Bï¼š</strong> æ–°è½¨è¿¹æ›´çƒ‚äº† ($J_{new} \ge J_{old}$)
åŸå› ï¼š è¿™é€šå¸¸æ˜¯å› ä¸ºæ¨¡å‹æ˜¯éçº¿æ€§çš„ï¼Œè€Œ Backward Pass æ˜¯åŸºäºçº¿æ€§è¿‘ä¼¼ç®—çš„ã€‚æ­¥å­è¿ˆå¤ªå¤§ï¼ˆ$\alpha=1.0$ï¼‰ï¼Œå¯¼è‡´â€œç”šè‡³ä¸å¦‚ä¸æ”¹â€ã€‚
åˆ¤å®šï¼š æ‹’ç»æ¥æ”¶ï¼
åŠ¨ä½œï¼šå‡å°æ­¥é•¿ï¼š $\alpha = \alpha \times 0.5$ (æˆ–è€…é™¤ä»¥æŸä¸ªæ¯”ä¾‹ï¼Œä»£ç é‡Œæ˜¯ solver_config_.alpha_line_search_regular)ã€‚é‡æ¥ï¼ å¸¦ç€è¿™ä¸ªæ›´å°çš„ $\alpha$ï¼Œé‡æ–°æ‰§è¡Œåˆšæ‰é‚£ä¸ª for å¾ªç¯ï¼ˆå‰å‘é€’æ¨ï¼‰ã€‚</p>
<p><strong>iLQRè¿­ä»£è¿‡ç¨‹</strong></p>
<pre class="mermaid">graph TD
    A[å¼€å§‹è¿­ä»£] --&gt; B[Backward Pass: ç®— K, k]
    B --&gt; C{è®¾ç½® alpha = 1.0}
    C --&gt; D[Forward Pass: åˆšæ‰å†™çš„ä»£ç , ç®—å‡º x_new, u_new]
    D --&gt; E[è®¡ç®—æ–°ä»£ä»· J_new]
    E --&gt; F{J_new &lt; J_old ?}
    
    F -- Yes (æ›´å¥½) --&gt; G[æ¥å—: æ›´æ–°æ—§è½¨è¿¹, è¿­ä»£ç»“æŸ]
    F -- No (æ›´çƒ‚) --&gt; H[æ‹’ç»: alpha å‡åŠ]
    H --&gt; I{alpha &lt; é˜ˆå€¼?}
    I -- No --&gt; D
    I -- Yes (å®åœ¨æ²¡æ•‘äº†) --&gt; J[ç»ˆæ­¢: å¢åŠ æ­£åˆ™åŒ– mu, é‡åš Backward]</pre>
<p><strong>Levenberg-Marquardt æ­£åˆ™åŒ–ï¼š</strong>
æ­£å®šæ„å‘³ç€ä»£ä»·å‡½æ•°çš„å½¢çŠ¶æ˜¯ä¸€ä¸ªç¢—ï¼ˆæœ‰æœ€ä½ç‚¹ï¼‰ã€‚å¦‚æœ $Q_{uu}$ ä¸æ˜¯æ­£å®šçš„ï¼ˆæ¯”å¦‚å®ƒæ˜¯å¹³çš„ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªé©¬éé¢ï¼‰ï¼Œæ±‚é€†å°±ä¼šå‡ºé”™ï¼Œæˆ–è€…ç®—å‡ºæ¥çš„æ–¹å‘æ˜¯é”™è¯¯çš„ï¼ˆåè€Œè®©ä»£ä»·å˜å¤§äº†ï¼‰ã€‚
å½“ $Q_{uu}$ ä¸æ­£å®šæ—¶ï¼ŒLevenberg-Marquardt ç®—æ³•è¯´ï¼šâ€œåˆ«æ€¥ï¼Œæˆ‘ä»¬åœ¨å¯¹è§’çº¿ä¸ŠåŠ ä¸ªæ­£æ•° $\mu$ã€‚â€</p>
<p>$$Q_{uu}^{new} = Q_{uu} + \mu \cdot \mathbf{I}$$
åŠ äº† $\mu$ ä¹‹åï¼šçŸ©é˜µä¼šå˜å¾—â€œæ›´æ­£å®šâ€ï¼Œå½¢çŠ¶ä¼šå¼ºè¡Œå˜æˆä¸€ä¸ªâ€œç¢—â€ï¼Œä¿è¯ä¸€å®šèƒ½æ±‚é€†ã€‚ä»£ä»·ï¼šç®—å‡ºæ¥çš„æ§åˆ¶æ–¹å‘ä¼šåç¦»çº¯ç²¹çš„ç‰›é¡¿æ–¹å‘ï¼Œæ›´åƒæ¢¯åº¦ä¸‹é™çš„æ–¹å‘ï¼ˆæ­¥é•¿å˜å°ï¼Œæ›´ä¿å®ˆï¼‰ã€‚</p>
<h2><span id="alilqr%E7%9A%84%E5%A4%96%E5%B1%82%E5%BE%AA%E7%8E%AF">ALiLQRçš„å¤–å±‚å¾ªç¯</span></h2>
<p>AL-iLQR çš„ç›®æ ‡å‡½æ•°ï¼ˆLagrangianï¼‰å®é™…ä¸Šç”± ä¸‰éƒ¨åˆ† ç»„æˆï¼š</p>
<p>$$L(x) = \underbrace{J(x)}_{\text{åŸå§‹ä»£ä»·}} + \underbrace{\lambda \cdot C(x)}_{\text{æ‹‰æ ¼æœ—æ—¥é¡¹}} + \underbrace{\frac{1}{2} \mu \cdot C(x)^2}_{\text{äºŒæ¬¡æƒ©ç½šé¡¹}}$$</p>
<p>å‰æ–‡æ‰€è¯´çš„iLQRè¿‡ç¨‹å…¶å®æ²¡åŠ è¿™äº›çº¦æŸï¼Œç°åœ¨è€ƒè™‘åŠ ä¸Š</p>
<p>$$L(x, u) = \underbrace{J_{action}(x, u)}_{\text{ActionCostFunction}} + \underbrace{\sum \left( \lambda C(x) + \frac{1}{2}\mu C(x)^2 \right)}_{\text{ConstrainCost (Linear Obstacle)}}$$</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. å…ˆæ‹¿ ActionCost (åŸºç¡€åœ°å½¢)</span><br>Px.<span class="hljs-built_in">noalias</span>() = state_cost_func_-&gt;<span class="hljs-built_in">gradient_lx</span>(index_step);<br>Pxx.<span class="hljs-built_in">noalias</span>() = state_cost_func_-&gt;<span class="hljs-built_in">hessian_lxx</span>(index_step);<br><br><span class="hljs-comment">// 2. å†åŠ ä¸Š Linear Constraints (AL ä¿®æ­£)</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; iter : linear_constrain_cost_list) {<br>    Px.<span class="hljs-built_in">noalias</span>() += iter-&gt;<span class="hljs-built_in">gradient_lx</span>(index_step); <span class="hljs-comment">// ç´¯åŠ </span><br>    Pxx.<span class="hljs-built_in">noalias</span>() += iter-&gt;<span class="hljs-built_in">hessian_lxx</span>(index_step); <span class="hljs-comment">// ç´¯åŠ </span><br>}<br><br><span class="hljs-comment">// 3. å†åŠ ä¸Š Obstacle Constraints (AL ä¿®æ­£)</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; iter : obstacle_constrain_cost_list) {<br>    Px.<span class="hljs-built_in">noalias</span>() += iter-&gt;<span class="hljs-built_in">gradient_lx</span>(index_step); <span class="hljs-comment">// ç´¯åŠ </span><br>    Pxx.<span class="hljs-built_in">noalias</span>() += iter-&gt;<span class="hljs-built_in">hessian_lxx</span>(index_step); <span class="hljs-comment">// ç´¯åŠ </span><br>}<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> idx = <span class="hljs-number">0</span>; idx &lt; solver_config_.max_iteration; idx++) {<br>        <span class="hljs-comment">// å¦‚æœæ­£åˆ™åŒ–å‚æ•°è¿‡å¤§ï¼Œè¯´æ˜é—®é¢˜å¾ˆéš¾è§£ï¼Œæå‰é€€å‡º</span><br>        <span class="hljs-keyword">if</span> (mu_ &gt; solver_config_.regular_mu_max) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">// --- 3. å‡†å¤‡æ•°æ® ---</span><br>        <span class="hljs-comment">// æ ¹æ®å½“å‰çš„ x å’Œ uï¼Œè®¡ç®—æ‰€æœ‰ CostFunction çš„ Hessian å’Œ Gradient</span><br>        <span class="hljs-comment">// è¿™ä¸€æ­¥å°±æ˜¯ä¹‹å‰è®¨è®ºçš„ï¼šè®¡ç®— l_x, l_u, l_xx, l_uu</span><br>        optimal_cost = <span class="hljs-built_in">update_traj_of_costfunc_list</span>(optimal_states_ptr_, optimal_inputs_ptr_);<br>        last_cost = optimal_cost;<br>        <span class="hljs-comment">// --- 4. Backward Pass (è®¡ç®—ç­–ç•¥ K, k) ---</span><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">backward_pass</span>()) {<br>            <span class="hljs-comment">// å¦‚æœçŸ©é˜µåˆ†è§£å¤±è´¥ (éæ­£å®š)ï¼Œè¯´æ˜å½“å‰æ­¥å­è¿ˆå¤ªå¤§äº†æˆ–è€…åœ°å½¢å¤ªå¤æ‚</span><br>            <span class="hljs-comment">// å¢å¤§æ­£åˆ™åŒ–å‚æ•° mu_ï¼Œè®©çŸ©é˜µå˜å¾—â€œæ›´å¯¹è§’åŒ–â€ï¼Œç„¶åé‡è¯•</span><br>            mu_ = mu_ * solver_config_.mu_regular;<br>            std::cout &lt;&lt; <span class="hljs-string">"backward pass failed, increase mu to "</span> &lt;&lt; mu_ &lt;&lt; std::endl;<br>            <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// è·³è¿‡æœ¬æ¬¡å¾ªç¯ï¼Œå¸¦ç€æ›´å¤§çš„ mu é‡è¯•</span><br>        }<br>        <span class="hljs-comment">// --- 5. Forward Pass (ç”Ÿæˆæ–°è½¨è¿¹) ---</span><br>        <span class="hljs-type">bool</span> forward_succ_flag = <span class="hljs-literal">false</span>;<br>        <span class="hljs-comment">// å°è¯•ç”Ÿæˆæ–°è½¨è¿¹ï¼Œforward_pass å†…éƒ¨åŒ…å«äº† Line Search</span><br>        <span class="hljs-keyword">if</span> (!forward_pass(optimal_cost)) {<br>            <span class="hljs-comment">// å¦‚æœ Line Search å¤±è´¥ (æ–°è½¨è¿¹ä»£ä»·æ²¡é™ä½)</span><br>            <span class="hljs-comment">// åŒæ ·å¢å¤§æ­£åˆ™åŒ–å‚æ•° mu_ï¼Œè®©ä¸‹ä¸€æ¬¡ Backward ç®—å‡ºçš„ç­–ç•¥æ›´ä¿å®ˆ</span><br>            mu_ = mu_ * solver_config_.mu_regular;<br>             std::cout &lt;&lt; <span class="hljs-string">"forward pass failed, increase mu"</span> &lt;&lt; std::endl;<br>            <span class="hljs-comment">// æ³¨æ„ï¼šä»£ç é€»è¾‘å¯èƒ½æ˜¯ continueï¼Œæˆ–è€…åœ¨è¿™é‡Œå°±æ¥å—å¤±è´¥</span><br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-comment">// æˆåŠŸï¼ä»£ä»·é™ä½äº†</span><br>            forward_succ_flag = <span class="hljs-literal">true</span>;<br>            <span class="hljs-comment">// å‡å° mu_ï¼Œå› ä¸ºä¼˜åŒ–å¾ˆé¡ºåˆ©ï¼Œå¯ä»¥è¿ˆå¤§æ­¥å­åŠ é€Ÿæ”¶æ•›</span><br>            mu_ = std::<span class="hljs-built_in">max</span>(solver_config_.regular_mu_min, mu_ / solver_config_.mu_regular);<br>            <span class="hljs-comment">// è·å–æ–°è½¨è¿¹çš„çœŸå® Cost</span><br>            optimal_cost = <span class="hljs-built_in">get_traj_value</span>(optimal_states_ptr_, optimal_inputs_ptr_);<br>        }<br><br>        <span class="hljs-comment">// å¦‚æœ Forward å¤±è´¥äº†ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ï¼ˆå¸¦ç€æ›´å¤§çš„ mu é‡è¯•ï¼‰</span><br>        <span class="hljs-keyword">if</span> (!forward_succ_flag) <span class="hljs-keyword">continue</span>;<br><br>        <span class="hljs-comment">// --- 6. çº¦æŸæ£€æŸ¥ (AL Update Logic) ---</span><br>        <span class="hljs-type">bool</span> convergence = <span class="hljs-literal">true</span>; <br>        <br>        <span class="hljs-comment">// A. æ£€æŸ¥çº¿æ€§çº¦æŸ (å¦‚è¾¹ç•Œ)</span><br>        <span class="hljs-type">bool</span> linear_convergence = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; iter : linear_constrain_cost_list) {<br>            <span class="hljs-comment">// update_constrain_value è¿”å› true è¡¨ç¤ºæ»¡è¶³çº¦æŸ</span><br>            <span class="hljs-comment">// è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼šåªè¦æœ‰ä¸€ä¸ªä¸æ»¡è¶³ï¼Œlinear_convergence å°±ä¸º false</span><br>            linear_convergence = (iter-&gt;<span class="hljs-built_in">update_constrain_value</span>()) &amp;&amp; linear_convergence;<br>        }<br>        <span class="hljs-keyword">if</span> (!linear_convergence) {<br>            <span class="hljs-comment">// std::cout &lt;&lt; "Linear constraint violated" &lt;&lt; std::endl;</span><br>        }<br><br>        <span class="hljs-comment">// B. æ£€æŸ¥éšœç¢ç‰©çº¦æŸ (å¦‚ç¢°æ’)</span><br>        <span class="hljs-type">bool</span> obstacle_convergence = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; iter : obstacle_constrain_cost_list) {<br>            obstacle_convergence = (iter-&gt;<span class="hljs-built_in">update_constrain_value</span>()) &amp;&amp; obstacle_convergence;<br>             <span class="hljs-keyword">if</span> (!obstacle_convergence) <span class="hljs-keyword">break</span>; <span class="hljs-comment">// æœ‰ä¸€ä¸ªæ’äº†å°±è¡Œäº†</span><br>        }<br><br>        <span class="hljs-comment">// æ€»çš„çº¦æŸæ”¶æ•›æ ‡å¿—</span><br>        convergence = convergence &amp;&amp; linear_convergence &amp;&amp; obstacle_convergence;<br><br>        <span class="hljs-comment">// --- 7. æ›´æ–° AL æƒ©ç½š (The "Boss" Steps In) ---</span><br>        <span class="hljs-comment">// åªæœ‰åœ¨çº¦æŸæœªæ»¡è¶³æ—¶ï¼Œæ‰éœ€è¦å¢åŠ æƒ©ç½š</span><br>        <br>        <span class="hljs-comment">// æ›´æ–°çº¿æ€§çº¦æŸçš„ Lambda å’Œ Mu (Penalty)</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; iter : linear_constrain_cost_list) {<br>             iter-&gt;<span class="hljs-built_in">update_lamda_penalty</span>(solver_config_.penatly_growth_factor);<br>        }<br>        <br>        <span class="hljs-comment">// æ›´æ–°éšœç¢ç‰©çº¦æŸçš„ Lambda å’Œ Mu (Penalty)</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; iter : obstacle_constrain_cost_list) {<br>             iter-&gt;<span class="hljs-built_in">update_lamda_penalty</span>(solver_config_.penatly_growth_factor);<br>        }<br><br>        <span class="hljs-comment">// --- 8. ç»ˆæ­¢æ¡ä»¶æ£€æŸ¥ ---</span><br>        <span class="hljs-comment">// å¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</span><br>        <span class="hljs-comment">// 1. Cost å˜åŒ–å¾ˆå° (std::abs(optimal_cost - last_cost) &lt; threshold) -&gt; è¯´æ˜ iLQR æ”¶æ•›äº†</span><br>        <span class="hljs-comment">// 2. convergence ä¸º true -&gt; è¯´æ˜çº¦æŸéƒ½æ»¡è¶³äº†</span><br>        <br>        <span class="hljs-keyword">if</span> ((std::<span class="hljs-built_in">abs</span>(optimal_cost - last_cost) &lt; solver_config_.convergence_threshold) &amp;&amp; <br>            convergence) {<br>            <br>            <span class="hljs-comment">// æ‰“å°æˆåŠŸä¿¡æ¯</span><br>            <span class="hljs-comment">// std::cout &lt;&lt; "Converged at iter: " &lt;&lt; idx &lt;&lt; std::endl;</span><br>            <span class="hljs-keyword">return</span> SolverStatus::SUCCESS;<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-comment">// æ‰“å°æœªæ”¶æ•›ä¿¡æ¯</span><br>            <span class="hljs-comment">// std::cout &lt;&lt; "Not converged, iter: " &lt;&lt; idx &lt;&lt; " Cost: " &lt;&lt; optimal_cost &lt;&lt; std::endl;</span><br>        }<br><br>    } <span class="hljs-comment">// End Loop</span><br><br></code></pre></td></tr></tbody></table></figure>
<p>åœ¨æ¯æ¬¡AL Iterationä¸­ï¼Œæˆ‘ä»¬å…ˆè°ƒç”¨å†…å±‚çš„iLQRæ›´æ–°ä»£ä»·ï¼Œç„¶åæ¥èŒ¬çº¿æ€§çº¦æŸå’Œéšœç¢ç‰©çº¦æŸã€‚
å¦‚æœæ²¡æœ‰æœ€ä¼˜ï¼Œæ›´æ–°æƒ©ç½šï¼ˆupdate lambda penaltyï¼‰ï¼š
Lambda ($\lambda$) å’Œ Penalty ($\mu$) ä¸éœ€è¦åƒ $x$ æˆ– $u$ é‚£æ ·æ±‚å¯¼ã€è§£æ–¹ç¨‹ã€‚
å®ƒä»¬çš„æ›´æ–°è§„åˆ™éå¸¸ç®€å•ç²—æš´ï¼Œå°±æ˜¯**â€œåéªŒè°ƒæ•´â€**ã€‚
<strong>æ›´æ–°æ‹‰æ ¼æœ—æ—¥ä¹˜å­ ($\lambda$):</strong>$\lambda_{new} = \lambda_{old} + \mu \cdot C(x)$ç›´è§‰ï¼š åˆšæ‰æ’å¾—è¶Šç‹ ï¼ˆ$C(x)$ è¶Šå¤§ï¼‰ï¼Œ$\lambda$ å°±å˜å¾—è¶Šå¤§ã€‚$\lambda$ å°±åƒä¸€ä¸ªâ€œè®°ä»‡æœ¬â€ï¼Œå®ƒè®°ä½äº†ä½ åˆšæ‰åœ¨è¿™é‡ŒçŠ¯è¿‡é”™ï¼Œä¸‹æ¬¡ç»è¿‡è¿™é‡Œæ—¶ï¼ŒåŸºç¡€ä»£ä»·å°±ä¼šå¾ˆé«˜ã€‚</p>
<p><strong>æ›´æ–°æƒ©ç½šå› å­ ($\mu$ / Penalty):</strong>$\mu_{new} = \mu_{old} \times \text{growth\\_factor}$ç›´è§‰ï¼š ä»£ç é‡Œçš„ penatly_growth_factor é€šå¸¸æ˜¯ 5 æˆ– 10ã€‚è¿™æ„å‘³ç€ä¸‹ä¸€è½®ï¼Œéšœç¢ç‰©è¿™å µå¢™çš„â€œç¡¬åº¦â€ä¼šå˜æˆåˆšæ‰çš„ 10 å€ã€‚iLQR ä¼šå‘ç°æ’å¢™çš„ä»£ä»·å˜å¾—æ— æ³•æ‰¿å—ï¼Œè¢«è¿«é€‰æ‹©ç»•è·¯ã€‚</p>
<h2><span id="alilqr%E7%9A%84constraincost%E6%9E%84%E5%BB%BA">ALiLQRçš„ConstrainCostæ„å»º</span></h2>
<ol>
<li>è½¦è¾†æ¨¡å‹ï¼šè¦†ç›–åœ†åˆ†è§£ (Circle Decomposition)
åœ¨è½¦èº«ä¸­è½´çº¿ä¸Šæ”¾ä¸€ä¸²åœ†å½¢ã€‚åªè¦è¿™å‡ ä¸ªåœ†éƒ½ä¸æ’ï¼Œè½¦å°±ä¸æ’ã€‚
çŠ¶æ€ï¼š$x = [pos\\_x, pos\\_y, \theta, \dots]$
ç¬¬ $j$ ä¸ªåœ†å¿ƒçš„ä½ç½®ï¼š</li>
</ol>
<p>$$\begin{cases}P_{cx} = pos_x + bias_j \cdot \cos(\theta) \\ P_{cy} = pos_y + bias_j \cdot \sin(\theta)\end{cases}$$</p>
<ol start="2">
<li>éšœç¢ç‰©æ¨¡å‹ï¼šç®€å•çš„åœ†/ç‚¹å‡è®¾éšœç¢ç‰©ä½äº $(x_{obs}, y_{obs})$ã€‚</li>
<li>çº¦æŸå‡½æ•° $C(x)$æˆ‘ä»¬å®šä¹‰ï¼šå¦‚æœè·ç¦»çš„å¹³æ–¹å°äºæŸä¸ªé˜ˆå€¼ $R_{safe}^2$ï¼Œå°±æ˜¯è¿è§„ã€‚</li>
</ol>
<p>$$C(x) = R_{safe}^2 - \left( (P_{cx} - x_{obs})^2 + (P_{cy} - y_{obs})^2 \right)$$
å¦‚æœ $C(x) &gt; 0$ $\rightarrow$ æ’äº†ï¼ˆè·ç¦»å¤ªè¿‘ï¼‰ã€‚å¦‚æœ $C(x) \le 0$ $\rightarrow$ å®‰å…¨ã€‚
åˆ©ç”¨é“¾å¼æ³•åˆ™æ±‚å¯¼ï¼š</p>
<ol>
<li>å¯¹ $pos\\_x$ æ±‚å¯¼ï¼š</li>
</ol>
<p>$$\frac{\partial C}{\partial pos\\_x} = -2\Delta x \cdot \frac{\partial P_{cx}}{\partial pos\\_x} = -2\Delta x \cdot 1 = -2\Delta x$$</p>
<ol start="2">
<li>å¯¹ $pos\\_y$ æ±‚å¯¼ï¼š</li>
</ol>
<p>$$\frac{\partial C}{\partial pos\\_y} = -2\Delta y \cdot 1 = -2\Delta y$$</p>
<ol start="3">
<li>å¯¹ $\theta$ æ±‚å¯¼ (å…³é”®ï¼)ï¼š</li>
</ol>
<p>$$\frac{\partial C}{\partial \theta} = -2\Delta x \cdot \frac{\partial P_{cx}}{\partial \theta} - 2\Delta y \cdot \frac{\partial P_{cy}}{\partial \theta}$$
$\frac{\partial P_{cx}}{\partial \theta} = -bias_j \cdot \sin(\theta)$
$\frac{\partial P_{cy}}{\partial \theta} = bias_j \cdot \cos(\theta)$</p>
<h3><span id="%E7%BB%84%E8%A3%85">ç»„è£…ï¼š</span></h3>
<p><strong>æ¢¯åº¦ $l_x$ (Gradient)</strong></p>
<p>$$l_x = \frac{\partial L}{\partial x} = (\lambda + \mu \cdot C(x)) \cdot Câ€™(x)$$</p>
<p><strong>Hessian $l_{xx}$ (Hessian)</strong></p>
<p>$$l_{xx} = \mu \cdot Câ€™(x)^T \cdot Câ€™(x) + (\lambda + \mu C) \cdot Câ€™'(x)$$</p>
<p>ä¸ºä»€ä¹ˆ ConstraintCost åˆ¶é€ äº†éå¯¹è§’é¡¹ï¼Ÿ
ConstraintCost ä½¿ç”¨äº† Gauss-Newton è¿‘ä¼¼ï¼š
$H \approx \mu \cdot \mathbf{J} \mathbf{J}^T$ã€‚</p>
<p>è¿™é‡Œçš„ $\mathbf{J}$ æ˜¯çº¦æŸå‡½æ•° $C(x)$ çš„æ¢¯åº¦å‘é‡ï¼ˆ$3 \times 1$ï¼‰ï¼š</p>
<p>$$\mathbf{J} = \begin{bmatrix} \frac{\partial C}{\partial x} \\ \frac{\partial C}{\partial y} \\ \frac{\partial C}{\partial \theta} \end{bmatrix}$$</p>
<p>å½“æˆ‘ä»¬åšå¤–ç§¯ï¼ˆOuter Productï¼‰ $\mathbf{J} \mathbf{J}^T$ æ—¶ï¼š</p>
<p>$$\mathbf{J} \mathbf{J}^T = \begin{bmatrix} (\frac{\partial C}{\partial x})^2 &amp; \color{red}{\frac{\partial C}{\partial x}\frac{\partial C}{\partial y}} &amp; \color{red}{\frac{\partial C}{\partial x}\frac{\partial C}{\partial \theta}} \\ \color{red}{\frac{\partial C}{\partial y}\frac{\partial C}{\partial x}} &amp; (\frac{\partial C}{\partial y})^2 &amp; \color{red}{\frac{\partial C}{\partial y}\frac{\partial C}{\partial \theta}} \\ \color{red}{\frac{\partial C}{\partial \theta}\frac{\partial C}{\partial x}} &amp; \color{red}{\frac{\partial C}{\partial \theta}\frac{\partial C}{\partial y}} &amp; (\frac{\partial C}{\partial \theta})^2 \end{bmatrix}$$</p>
<!-- hexo injector body_end start -->
<!-- Mermaid Scripts -->
<script>
// æ£€æŸ¥é¡µé¢æ˜¯å¦åŒ…å«Mermaidå†…å®¹
const hasMermaid = document.querySelector('.mermaid') !== null;

// å¦‚æœå­˜åœ¨Mermaidå›¾è¡¨ï¼Œåˆ™åŠ è½½Mermaidåº“
if (hasMermaid) {
  // åŠ è½½Mermaidåº“
  const mermaidScript = document.createElement('script');
  mermaidScript.src = 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js';
  mermaidScript.onload = function() {
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      securityLevel: 'loose',
      fontFamily: 'inherit'
    });

    // é‡æ–°æ¸²æŸ“Mermaidå›¾è¡¨
    mermaid.init(undefined, '.mermaid');
  };
  document.head.appendChild(mermaidScript);
}
</script><!-- hexo injector body_end end --></body></html>
	</article>

	 
    <div class="kira-post-copyright">
        <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>æˆ˜æ–—åŒ…å­<br>
        <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://paipai121.github.io/2025/11/08/%E5%B7%A5%E4%BD%9C/iLQR%E5%AD%A6%E4%B9%A0/" title="https:&#x2F;&#x2F;paipai121.github.io&#x2F;2025&#x2F;11&#x2F;08&#x2F;å·¥ä½œ&#x2F;iLQRå­¦ä¹ &#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;paipai121.github.io&#x2F;2025&#x2F;11&#x2F;08&#x2F;å·¥ä½œ&#x2F;iLQRå­¦ä¹ &#x2F;</a><br>
        
            <strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> åè®®è¿›è¡Œè®¸å¯
        
    </div>

  
	<div class="kira-post-nav">
		<nav class="post-nav">
			
		</nav>
	</div>
	
	<div class="kira-post-meta kira-rainbow">
		
		
			<a class="kirafont icon-tag-fill -none-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">å­¦ä¹ </a>
		
	</div>
	
	<div class="kira-post-footer">
		

		
	<div class="giscus"></div>
  
    <script src="https://giscus.app/client.js"
      data-repo="PaiPai121/discuss"
      data-repo-id="R_kgDOMFuZdw"
      data-category="Announcements"
      data-category-id="DIC_kwDOMFuZd84Cf5yz"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="preferred_color_scheme"
      data-lang="zh-CN"
      data-loading="lazy"
      crossorigin="anonymous"
      async  
    ></script>
  

	</div>
	
</div>

				</div>
			</div>
			<div class="kira-right-column">
	<a onclick="document.querySelector('#kira-top-header').scrollIntoView({behavior: 'smooth'});" class="kira-backtotop" aria-label="å›åˆ°é¡¶éƒ¨" title="å›åˆ°é¡¶éƒ¨">
		<button class="mdui-fab mdui-ripple">
			<i class="kirafont icon-caret-up"></i>
		</button>
	</a>
</div>

		</div>
	</body>
</html>
